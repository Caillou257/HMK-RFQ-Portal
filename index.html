<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMKAS - Professional RFQ System</title>
    
    <!-- EmailJS Configuration -->
    <script src="emailjs-config.js"></script>
    
    <!-- reCAPTCHA v2 -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }
        
        * {
            box-sizing: border-box;
        }
        
        .container {
            max-width: 100vw;
            width: 100vw;
            margin: 0;
            background: white;
            padding: 40px 20px 30px 20px;
            box-sizing: border-box;
            overflow-x: hidden;
            border-radius: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
        
        h1, h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .filters {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 0;
        }
        
        .filter-group {
            margin-bottom: 0;
            margin-right: 8px;
            min-width: 140px;
        }
        
        .filter-group:first-child {
            flex: 1;
            max-width: 400px;
        }
        
        .filter-group label {
            margin-bottom: 2px;
            font-size: 0.98em;
            font-weight: bold;
            text-align: center;
            display: block;
        }
        
        .filter-group input,
        .filter-group select {
            padding: 4px 6px;
            height: 28px;
            font-size: 0.98em;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
        }
        
        .product-count {
            text-align: center;
            color: #000;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        .product-table {
            border-collapse: collapse;
            width: 100%;
            background: #fff;
            table-layout: fixed;
            max-width: 100%;
        }
        
        .product-table th, .product-table td {
            border: 1px solid #e0e0e0;
            padding: 18px 10px;
            height: 56px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .product-table th:nth-child(1), .product-table td:nth-child(1) {
            width: 15%;
            min-width: 120px;
        }
        
        .product-table th:nth-child(2), .product-table td:nth-child(2) {
            width: 45%;
            min-width: 250px;
        }
        
        .product-table th:nth-child(3), .product-table td:nth-child(3) {
            width: 10%;
            min-width: 80px;
        }
        
        .product-table th:nth-child(4), .product-table td:nth-child(4) {
            width: 10%;
            min-width: 80px;
        }
        
        .product-table th:nth-child(5), .product-table td:nth-child(5) {
            width: 10%;
            min-width: 80px;
            text-align: center;
        }
        
        .product-table th:nth-child(6), .product-table td:nth-child(6) {
            width: 10%;
            min-width: 100px;
            text-align: center;
        }
        
        .product-table th {
            background: #f8f8f8;
            color: #1a237e;
            font-size: 1.08em;
            font-weight: 700;
            text-align: center;
        }
        
        .product-table td {
            font-size: 1.04em;
            vertical-align: middle;
        }
        
        .product-table td:first-child {
            font-weight: 700;
            color: #007bff;
            font-size: 1.13em;
            letter-spacing: 0.01em;
            text-align: center;
        }
        
        .product-table td:nth-child(2) {
            color: #333;
            font-size: 1em;
            font-weight: 500;
            padding-right: 18px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 0;
        }
        
        .product-table td:nth-child(3) {
            padding-left: 10px;
            text-align: center;
            position: relative;
        }
        
        .product-table td:nth-child(4),
        .product-table td:nth-child(5) {
            text-align: center;
        }
        
        .product-table tr:hover {
            background: #f5faff;
        }
        
        .quantity-input {
            width: 120px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-primary.active {
            box-shadow: 0 0 0 3px rgba(0,123,255,0.25) inset;
            border: 1px solid #0056b3;
        }
        .btn-lang img {
            display: block;
        }
        
        .btn-lang:hover {
            transform: none !important;
            box-shadow: 0 2px 8px rgba(0,123,255,0.2);
        }
        
        .view-toggle-container {
            display: flex;
            gap: 2px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 2px;
        }
        
        .view-toggle-btn {
            padding: 6px 10px;
            min-width: 36px;
            height: 32px;
            border: none;
            background: transparent;
            color: #6c757d;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .view-toggle-btn:hover {
            background: rgba(255,255,255,0.1);
            color: #007bff;
            transform: none !important;
        }
        
        .view-toggle-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }
        
        .view-icon {
            font-size: 14px;
            font-weight: bold;
        }
        
        .catalog-button-container {
            margin-top: 6px;
            display: flex;
            justify-content: center;
        }
        
        .btn-catalog {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        }
        
        .btn-catalog:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .catalog-icon {
            font-size: 16px;
        }
        
        /* Mobile responsive for catalog button */
        @media (max-width: 768px) {
            .catalog-button-container {
                margin-top: 6px;
            }
            
            .btn-catalog {
                padding: 6px 12px;
                font-size: 0.85em;
            }
            
            .catalog-icon {
                font-size: 14px;
            }
        }
        
        .btn-add {
            background-color: #28a745;
            color: white;
            padding: 5px 15px;
            font-size: 14px;
        }
        
        .btn-add:hover {
            background-color: #218838;
        }
        
        .btn-remove {
            background-color: #dc3545;
            color: white;
            padding: 5px 15px;
            font-size: 14px;
        }
        
        .order-summary {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .summary-table {
            width: 100%;
            margin-bottom: 20px;
            table-layout: auto;
        }
        
        .summary-table th,
        .summary-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .summary-table td:nth-child(2) {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
        }
        
        /* Column widths for summary table */
        .summary-table th:nth-child(1),
        .summary-table td:nth-child(1) {
            width: 12%;
            min-width: 120px;
        }
        
        .summary-table th:nth-child(2),
        .summary-table td:nth-child(2) {
            width: auto;
            min-width: 200px;
            max-width: 70%;
        }
        
        .summary-table th:nth-child(3),
        .summary-table td:nth-child(3) {
            width: 10%;
            min-width: 80px;
        }
        
        .summary-table th:nth-child(4),
        .summary-table td:nth-child(4) {
            width: 8%;
            min-width: 80px;
        }
        
        .customer-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .status-active {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-inactive {
            color: #dc3545;
            font-weight: bold;
        }
        
        .status-unknown {
            color: #ffc107;
            font-weight: bold;
        }
        
        .status-control {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .status-special-product {
            color: #17a2b8;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        
        .pagination-controls {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .pagination-controls button {
            margin: 0 5px;
        }
        
        .pagination-controls button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .pagination-controls select {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        .bestseller-badge {
            background-color: #ffd700;
            color: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 8px;
            display: inline-block;
        }
        
        .popular-product {
            background-color: #fff3cd !important;
            border-left: 4px solid #ffd700;
        }
        
        .popular-product:hover {
            background-color: #ffeaa7 !important;
        }
        
        /* Floating Order Basket */
        .floating-basket {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 320px;
            max-height: 80vh;
            background: #fff;
            border: 1.5px solid #e3e6ea;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.10);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        
        .basket-header {
            background: #007bff;
            color: white;
            padding: 18px 24px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            font-size: 1.1em;
        }
        
        .basket-header:hover {
            background: #0056b3;
        }
        
        .basket-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .basket-content {
            max-height: 60vh;
            overflow-y: auto;
            padding: 0 0 0 0;
            background: #f9f9f9;
        }
        
        .basket-item {
            padding: 14px 24px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
            background: #fff;
        }
        
        .basket-item:last-child {
            border-bottom: none;
        }
        
        .basket-item:hover {
            background-color: #f8f9fa;
        }
        
        .basket-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .basket-item-code {
            font-weight: bold;
            color: #007bff;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .basket-item-desc {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .basket-item-qty {
            font-weight: bold;
            color: #28a745;
            margin: 0 10px;
        }
        
        .basket-item-remove {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .basket-item-remove:hover {
            background: #c82333;
        }
        
        .basket-empty {
            padding: 40px 24px;
            text-align: center;
            color: #666;
            font-style: italic;
            background: #fff;
        }
        
        .basket-footer {
            background: #f8f9fa;
            padding: 18px 24px;
            border-top: 1px solid #dee2e6;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        
        .basket-total {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .basket-actions {
            display: flex;
            gap: 10px;
        }
        
        .basket-actions .btn {
            flex: 1;
            padding: 10px 0;
            font-size: 15px;
        }
        
        .basket-collapsed {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #007bff;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .basket-collapsed:hover {
            background: #0056b3;
            transform: scale(1.1);
        }
        
        .basket-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1600px) {
            .sidebar-status, .floating-basket {
                width: 250px;
            }
            .container {
                max-width: 100vw;
                width: 100vw;
                padding: 30px 6px;
            }
        }
        
        @media (max-width: 1200px) {
            .sidebar-status, .floating-basket {
                position: static;
                width: 100%;
                margin-bottom: 20px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.07);
            }
            .container {
                padding: 18px 2vw;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            
            .rfq-lang-topright {
                top: 15px;
                right: 15px;
            }
            .sidebar-status, .floating-basket {
                padding: 15px 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin-top: 80px;
                padding: 15px 10px;
            }
            
            .rfq-lang-topright {
                top: 10px;
                right: 10px;
            }
            .sidebar-status, .floating-basket {
                left: 0;
                right: 0;
                width: 100%;
                min-width: unset;
                max-width: unset;
                border-radius: 8px;
                padding: 10px 4px;
            }
        }
        
        /* Status Tooltip Box */
        .status-tooltip {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .status-tooltip h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .status-tooltip h3::before {
            content: "‚ÑπÔ∏è";
            font-size: 18px;
        }
        
        .status-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }
        
        .status-item {
            background: white;
            border-radius: 6px;
            padding: 15px;
            border-left: 4px solid;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
            box-sizing: border-box;
            word-break: break-word;
            max-width: 100%;
            overflow-wrap: break-word;
            min-width: 0;
        }
        
        .status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }
        
        .status-item.active {
            border-left-color: #28a745;
        }
        
        .status-item.inactive {
            border-left-color: #dc3545;
        }
        
        .status-item.unknown {
            border-left-color: #ffc107;
        }
        
        .status-item.bestseller {
            border-left-color: #ffd700;
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 14px;
            max-width: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .status-header.active {
            color: #28a745;
        }
        
        .status-header.inactive {
            color: #dc3545;
        }
        
        .status-header.unknown {
            color: #856404;
        }
        
        .status-header.bestseller {
            color: #856404;
        }
        
        .status-icon {
            font-size: 16px;
        }
        
        .status-description {
            color: #6c757d;
            font-size: 13px;
            line-height: 1.4;
            max-width: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .status-recommendation {
            margin-top: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            max-width: 100%;
            word-break: break-word;
            overflow-wrap: break-word;
        }
        
        .status-recommendation.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-recommendation.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-recommendation.unknown {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-recommendation.bestseller {
            background: #fff8e1;
            color: #856404;
        }
        
        /* Responsive adjustments for status tooltip */
        @media (max-width: 768px) {
            .status-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .status-tooltip {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .status-item {
                padding: 12px;
            }
            
            .status-description {
                font-size: 12px;
            }
            
            .status-recommendation {
                font-size: 11px;
                padding: 5px 8px;
            }
        }
        
        @media (max-width: 480px) {
            .status-tooltip h3 {
                font-size: 14px;
            }
            
            .status-header {
                font-size: 13px;
            }
            
            .status-description {
                font-size: 11px;
            }
        }
        
        /* Alternative Product Suggestion Modal */
        .alternative-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .alternative-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 95vw;
            width: auto;
            max-height: 95vh;
            height: auto;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
            margin: 20px;
        }
        
        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            color: #666;
            font-size: 24px;
            font-weight: bold;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .modal-close-btn:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
            transform: scale(1.1);
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .alternative-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
            position: relative;
        }
        
        .alternative-header h3 {
            color: #495057;
            margin: 0;
            font-size: 18px;
        }
        
        .alternative-icon {
            font-size: 24px;
        }
        
        .alternative-product-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .alternative-product-info.inactive {
            border-left-color: #dc3545;
        }
        
        .alternative-product-info.unknown {
            border-left-color: #ffc107;
        }
        
        .product-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        
        .product-status {
            font-size: 14px;
            color: #6c757d;
        }
        
        .alternative-options {
            margin-bottom: 25px;
        }
        
        .alternative-options h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .option-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .option-item:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
        }
        
        .option-item.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }
        
        .option-item.selected::after {
            content: "‚úì";
            position: absolute;
            top: 8px;
            right: 8px;
            background: #007bff;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .option-item.remove-option {
            border-color: #dc3545;
        }
        
        .option-item.remove-option:hover {
            border-color: #c82333;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.15);
        }
        
        .option-item.remove-option.selected {
            border-color: #dc3545;
            background: #fff5f5;
        }
        
        .option-item.remove-option.selected::after {
            background: #dc3545;
        }
        
        .option-icon {
            font-size: 20px;
            margin-bottom: 8px;
            display: block;
            text-align: center;
        }
        
        .option-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .option-description {
            color: #6c757d;
            font-size: 12px;
            line-height: 1.3;
        }
        
        .alternative-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }
        
        .alternative-actions .btn {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .selected-count {
            color: #007bff;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        /* Responsive adjustments for alternative modal */
        @media (max-width: 768px) {
            .alternative-content {
                padding: 20px;
                margin: 10px;
                max-width: 95vw;
                width: auto;
                max-height: 95vh;
                height: auto;
            }
            
            .option-grid {
                grid-template-columns: 1fr;
            }
            
            .alternative-actions {
                flex-direction: column;
            }
            
            .alternative-actions .btn {
                width: 100%;
            }
        }
        
        /* Basket item status styling */
        .basket-item.status-active {
            border-left: 4px solid #28a745;
        }
        
        .basket-item.status-inactive {
            border-left: 4px solid #dc3545;
        }
        
        .basket-item.status-unknown {
            border-left: 4px solid #ffc107;
        }
        
        .basket-item.status-special-product {
            border-left: 4px solid #17a2b8;
        }
        
        .basket-item-status {
            font-size: 11px;
            font-weight: bold;
            margin-top: 4px;
        }
        
        .basket-item-status.status-active {
            color: #28a745;
        }
        
        .basket-item-status.status-inactive {
            color: #dc3545;
        }
        
        .basket-item-status.status-unknown {
            color: #856404;
        }
        
        .basket-item-status.status-special-product {
            color: #17a2b8;
        }
        
        .basket-alternatives {
            font-size: 11px;
            color: #007bff;
            margin-top: 4px;
            font-style: italic;
            background: #f8f9ff;
            padding: 3px 6px;
            border-radius: 3px;
            border-left: 2px solid #007bff;
        }
        
        /* Add sidebar for status guide */
        .sidebar-status {
            position: fixed;
            top: 30px;
            left: 30px;
            width: 320px;
            z-index: 100;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.10);
            border: 1.5px solid #e3e6ea;
            padding: 28px 24px 24px 24px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            min-height: 400px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .container {
            margin-left: 0;
            margin-right: 0;
        }
        
        @media (max-width: 1000px) {
            .sidebar-status {
                position: static;
                width: 100%;
                margin-bottom: 20px;
            }
            .container {
                margin-left: 0;
                margin-right: 0;
            }
        }
        
        /* Tooltip for status info */
        .status-tooltip-icon {
            display: inline-block;
            margin-left: 6px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.15em;
            position: relative;
            vertical-align: middle;
            transition: color 0.2s;
        }
        .status-tooltip-icon:hover,
        .status-tooltip-icon:focus {
            color: #ffb300;
        }
        .status-tooltip-popup {
            display: none;
            position: fixed;
            background: #fffbe7;
            color: #333;
            border: 2px solid #ffe066;
            border-radius: 12px;
            box-shadow: 0 6px 24px rgba(255, 193, 7, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
            padding: 16px 18px;
            font-size: 14px;
            min-width: 240px;
            max-width: 400px;
            z-index: 999999;
            white-space: normal;
            pointer-events: none;
            transition: opacity 0.2s;
            opacity: 0;
        }
        .status-tooltip-icon:hover .status-tooltip-popup,
        .status-tooltip-icon:focus .status-tooltip-popup {
            display: block;
            pointer-events: auto;
            opacity: 1;
        }
        
        /* Position tooltip dynamically - handled by JavaScript */
        .status-tooltip-popup::before {
            content: '';
            position: absolute;
            top: 20px;
            left: -10px;
            border-width: 10px 10px 10px 0;
            border-style: solid;
            border-color: transparent #ffe066 transparent transparent;
            filter: drop-shadow(-2px 0 2px rgba(255,193,7,0.10));
        }
        .status-bestseller {
            color: #ffb300;
            font-weight: bold;
            background: linear-gradient(90deg, #fffbe7 60%, #ffe066 100%);
            border-radius: 6px;
            padding: 2px 10px 2px 8px;
            margin-left: 6px;
            display: inline-flex;
            align-items: center;
            font-size: 1em;
            box-shadow: 0 1px 4px rgba(255,193,7,0.10);
            letter-spacing: 0.01em;
            gap: 4px;
        }
        @media (max-width: 1000px) {
            .container {
                margin-left: 0;
                margin-right: 0;
            }
        }
        /* Page Layout Container */
        .page-container {
            display: flex;
            min-height: 100vh;
            background: #f8f9fa;
        }
        
        /* Main Content Area */
        .main-content-area {
            flex: 1;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none; /* Hidden by default */
        }
        
        .main-content-area[style*="display: block"] {
            display: block !important;
        }
        
        .main-content-area.basket-collapsed {
            margin-right: 0;
        }
        
        /* Basket Sidebar */
        .basket-sidebar {
            width: 400px;
            background: white;
            border-left: 1px solid #e0e0e0;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .basket-sidebar.collapsed {
            width: 60px;
        }
        
        .basket-sidebar.collapsed .basket-content,
        .basket-sidebar.collapsed .basket-footer {
            display: none;
        }
        
        .basket-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        
        .basket-header h3 {
            margin: 0;
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .basket-toggle {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .basket-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .basket-toggle::before {
            content: '‚àí';
        }
        
        .basket-sidebar.collapsed .basket-toggle::before {
            content: '‚õ∂';
        }
        
        .basket-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: #fafbfc;
            min-height: 450px;
        }
        
        .basket-footer {
            background: #f8f9fa;
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }
        .floating-cart-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(0,123,255,0.4);
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(220,53,69,0.4);
            border: 2px solid #fff;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .cart-btn-text {
            font-size: 1.1em;
            font-weight: 500;
            letter-spacing: 0.01em;
            margin-left: 4px;
            color: #fff;
            user-select: none;
        }
        /* Show cart panel on hover or click */
        .floating-cart-btn:focus + .cart-panel,
        .floating-cart-btn:hover + .cart-panel,
        .cart-panel.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        .floating-cart-btn:focus + .cart-panel-backdrop,
        .floating-cart-btn:hover + .cart-panel-backdrop,
        .cart-panel-backdrop.active {
            display: block;
        }
        /* Cart Panel */
        .cart-panel-backdrop {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.10);
            z-index: 1099;
        }
        .cart-panel {
            position: fixed;
            bottom: 110px;
            right: 32px;
            width: 380px;
            max-width: 95vw;
            max-height: 80vh;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            z-index: 1101;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }
        .cart-panel.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }
        
        /* Expandable Basket States */
        .cart-panel.expanded {
            width: 450px;
            right: 20px;
            bottom: 20px;
            top: 20px;
            max-height: calc(100vh - 40px);
            border-radius: 20px;
        }
        
        .cart-panel.minimized {
            width: 60px;
            height: 60px;
            bottom: 20px;
            right: 20px;
            border-radius: 30px;
            padding: 0;
            overflow: hidden;
            cursor: pointer;
        }
        
        .cart-panel.minimized .cart-panel-header,
        .cart-panel.minimized .cart-panel-content,
        .cart-panel.minimized .cart-panel-footer {
            display: none;
        }
        
        .cart-panel.minimized::before {
            content: 'üõí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: white;
        }
        
        .cart-panel.minimized .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            font-size: 10px;
        }
        
        .cart-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px 16px 24px;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-weight: 700;
            font-size: 1.2em;
            color: #333;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            position: relative;
        }
        
        .cart-panel-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #007bff, #0056b3, #007bff);
            background-size: 200% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }
        
        .cart-panel-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cart-expand-btn,
        .cart-minimize-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: #333;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }
        
        .cart-expand-btn:hover,
        .cart-minimize-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .cart-expand-btn::before {
            content: '‚õ∂';
        }
        
        .cart-minimize-btn::before {
            content: '‚õ∑';
        }
        
        /* Better icons for expand/minimize */
        .cart-expand-btn::before {
            content: '‚õ∂';
            font-size: 16px;
        }
        
        .cart-minimize-btn::before {
            content: '‚õ∑';
            font-size: 16px;
        }
        
        /* Tooltip styling */
        .cart-expand-btn[title]:hover::after,
        .cart-minimize-btn[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
        
        /* Product Grid Adjustment */
        .product-grid {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product-grid.basket-collapsed {
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .cart-panel-close {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5em;
            cursor: pointer;
            margin-left: 10px;
            transition: color 0.2s;
        }
        .cart-panel-close:hover {
            color: #dc3545;
        }
        .cart-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: #fafbfc;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        .cart-panel-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .cart-panel-content::-webkit-scrollbar-track {
            background: #f7fafc;
        }
        
        .cart-panel-content::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }
        
        .cart-panel-content::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Modern Cart Item Styling */
        .cart-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            background: white;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .cart-item:hover {
            background: #f8f9ff;
            transform: translateX(4px);
        }
        
        .cart-item:last-child {
            border-bottom: none;
        }
        
        .cart-item-info {
            flex: 1;
            min-width: 0;
            margin-right: 12px;
        }
        
        .cart-item-code {
            font-weight: 700;
            color: #007bff;
            font-size: 14px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .cart-item-code::before {
            content: 'üì¶';
            font-size: 12px;
        }
        
        .cart-item-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .cart-item-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
        }
        
        .cart-item-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .cart-item-status.active {
            background: #d4edda;
            color: #155724;
        }
        
        .cart-item-status.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        .cart-item-status.unknown {
            background: #fff3cd;
            color: #856404;
        }
        
        .cart-item-qty {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
        }
        
        .cart-item-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        .cart-item-remove {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220,53,69,0.2);
        }
        
        .cart-item-remove:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220,53,69,0.3);
        }
        
        .cart-item-remove::before {
            content: 'üóëÔ∏è';
            margin-right: 4px;
        }
        
        /* Empty Cart State */
        .cart-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: #666;
        }
        
        .cart-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .cart-empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .cart-empty-subtitle {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        /* Cart Item Alternatives Styling */
        .cart-item-alternatives {
            font-size: 11px;
            color: #007bff;
            background: #f0f8ff;
            padding: 4px 8px;
            border-radius: 8px;
            margin-top: 6px;
            border-left: 3px solid #007bff;
        }
        
        .cart-item-moq {
            font-size: 11px;
            font-weight: 600;
            margin-top: 4px;
        }
        .cart-panel-footer {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px 24px;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            border-top: 1px solid rgba(0,0,0,0.06);
            position: relative;
        }
        
        .cart-panel-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,123,255,0.3), transparent);
        }
        
        .cart-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .cart-summary-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .cart-summary-value {
            font-weight: 700;
            color: #007bff;
            font-size: 16px;
        }
        
        .cart-actions {
            display: flex;
            gap: 12px;
        }
        
        .cart-actions .btn {
            flex: 1;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .cart-actions .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        
        .cart-actions .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        
        .cart-actions .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(108,117,125,0.3);
        }
        
        .cart-actions .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108,117,125,0.4);
        }
        @media (max-width: 768px) {
            .cart-panel {
                right: 0;
                left: 0;
                bottom: 0;
                width: 100vw !important;
                max-width: unset;
                border-radius: 24px 24px 0 0 !important;
                box-shadow: 0 -8px 32px rgba(0,0,0,0.2);
                max-height: 90vh;
            }
            
            .cart-panel-header, .cart-panel-footer {
                border-radius: 0 !important;
            }
            
            .cart-panel-header {
                padding: 16px 20px 12px 20px;
                font-size: 1.1em;
            }
            
            .cart-panel-footer {
                padding: 16px 20px;
            }
            
            .cart-item {
                padding: 12px 16px;
            }
            
            .cart-item-actions {
                flex-direction: row;
                gap: 8px;
            }
            
            .cart-item-remove {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            .floating-cart-btn {
                bottom: 20px;
                right: 20px;
                min-width: 60px;
                height: 60px;
                font-size: 1.6em;
            }
            
            .cart-badge {
                width: 20px;
                height: 20px;
                font-size: 11px;
                top: -6px;
                right: -6px;
            }
            
            /* Mobile expandable basket */
            .cart-panel.expanded {
                width: 100vw;
                right: 0;
                left: 0;
                top: 0;
                bottom: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .main-content.basket-expanded {
                margin-right: 0;
            }
            
            .product-grid.basket-expanded {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .cart-panel.minimized {
                width: 50px;
                height: 50px;
                bottom: 15px;
                right: 15px;
            }
            
            .cart-panel.minimized::before {
                font-size: 20px;
            }
            
            /* Mobile Layout */
            .page-container {
                flex-direction: column;
            }
            
            .basket-sidebar {
                width: 100%;
                order: -1;
                border-left: none;
                border-bottom: 1px solid #e0e0e0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            }
            
            .basket-sidebar.collapsed {
                width: 100%;
                height: 60px;
            }
            
            .main-content-area {
                padding: 15px;
            }
        }
        /* Product image preview on hover */
        .product-img-emoji {
            cursor: pointer;
            margin-left: 6px;
            font-size: 1.1em;
            vertical-align: middle;
            position: relative;
            transition: color 0.2s;
        }
        .product-img-emoji:hover {
            color: #007bff;
        }
        .product-img-preview-global {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999999;
            background: #fff;
            border: 1.5px solid #eee;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            padding: 6px;
            min-width: 120px;
            min-height: 80px;
            max-width: 220px;
            max-height: 160px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.18s;
        }
        .product-img-preview-global.active {
            display: block;
            opacity: 1;
            pointer-events: auto;
        }
        /* Modern Order Form Card Design */
        .order-form-card {
            background: linear-gradient(135deg, #f8fafc 60%, #e9f0ff 100%);
            border-radius: 18px;
            box-shadow: 0 6px 32px rgba(0,0,0,0.10);
            padding: 38px 32px 32px 32px;
            max-width: 700px;
            margin: 0 auto 40px auto;
            border: 1.5px solid #e3e6ea;
            position: relative;
            animation: fadeInCard 0.7s cubic-bezier(.4,1.4,.6,1);
        }
        @keyframes fadeInCard {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: none; }
        }
        .order-form-heading {
            font-size: 2.1em;
            font-weight: 700;
            color: #1a237e;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .order-form-heading .heading-icon {
            font-size: 1.2em;
            color: #007bff;
        }
        .order-form-divider {
            height: 4px;
            width: 60px;
            background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%);
            border-radius: 2px;
            margin-bottom: 28px;
        }
        .customer-form-modern {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 28px 24px;
            margin-bottom: 18px;
        }
        @media (max-width: 700px) {
            .order-form-card {
                padding: 18px 6vw 18px 6vw;
            }
            .customer-form-modern {
                grid-template-columns: 1fr;
                gap: 18px 0;
            }
        }
        .form-group-modern {
            position: relative;
            margin-bottom: 0;
        }
        .form-group-modern input,
        .form-group-modern textarea {
            width: 100%;
            padding: 16px 16px 16px 44px;
            border: 1.5px solid #cfd8dc;
            border-radius: 8px;
            font-size: 1.08em;
            background: #fafdff;
            transition: border 0.2s, box-shadow 0.2s;
            outline: none;
            box-shadow: none;
        }
        .form-group-modern input:focus,
        .form-group-modern textarea:focus {
            border: 1.5px solid #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.08);
        }
        .form-group-modern label {
            position: absolute;
            left: 44px;
            top: 16px;
            color: #888;
            font-size: 1em;
            pointer-events: none;
            background: transparent;
            transition: 0.2s;
            z-index: 2;
        }
        .form-group-modern input:focus + span + label,
        .form-group-modern input.has-value + span + label,
        .form-group-modern input.focused + span + label,
        .form-group-modern textarea:focus + span + label,
        .form-group-modern textarea.has-value + span + label,
        .form-group-modern textarea.focused + span + label,
        .form-group-modern label.floating {
            top: -12px !important;
            left: 36px !important;
            font-size: 0.92em !important;
            color: #007bff !important;
            background: #f8fafc !important;
            padding: 0 6px !important;
            border-radius: 4px !important;
        }
        .form-group-modern .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
            color: #90caf9;
            z-index: 3;
            pointer-events: none;
        }
        .form-group-modern textarea {
            min-height: 90px;
            resize: vertical;
        }
        .order-form-actions {
            grid-column: 1/-1;
            text-align: center;
            margin-top: 18px;
        }
        .btn-modern {
            padding: 13px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%);
            color: #fff;
            cursor: pointer;
            margin: 0 8px 8px 0;
            box-shadow: 0 2px 8px rgba(0,123,255,0.08);
            transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-modern:hover {
            background: linear-gradient(90deg, #0056b3 60%, #00aaff 100%);
            box-shadow: 0 4px 16px rgba(0,123,255,0.13);
            transform: translateY(-2px) scale(1.03);
        }
        .order-summary-card {
            background: #fafdff;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            padding: 28px 24px 18px 24px;
            margin-bottom: 32px;
            border: 1.5px solid #e3e6ea;
            animation: fadeInCard 0.7s cubic-bezier(.4,1.4,.6,1);
        }
        .order-summary-card h3 {
            color: #1a237e;
            font-size: 1.3em;
            margin-bottom: 18px;
            font-weight: 700;
            letter-spacing: 0.01em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .order-summary-card .summary-table {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
            border: 1px solid #e3e6ea;
            margin-bottom: 18px;
        }
        .order-summary-card .summary-table th {
            background: #f3f7fa;
            color: #1a237e;
            font-weight: 600;
            font-size: 1em;
            border-radius: 8px 8px 0 0;
        }
        .order-summary-card .summary-table td {
            background: #fff;
            font-size: 0.98em;
        }
        /* --- Packing Qty Label --- */
        .packing-qty-label {
            display: inline-block;
            background: #f3f7fa;
            color: #007bff;
            font-size: 0.97em;
            font-weight: 600;
            border-radius: 6px;
            padding: 3px 10px;
            margin-right: 8px;
            margin-bottom: 2px;
        }
        /* --- Unified Interface Layout --- */
        .unified-interface-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-start;
            min-height: 600px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            padding: 0 30px;
        }
        
        .search-results-area {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .search-area-box {
            background: #f6f8fa;
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            padding: 4px 8px 2px 8px;
            border: 1px solid #e3e6ea;
        }
        
        .product-results-area {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1.5px 6px rgba(0,0,0,0.06);
            padding: 22px 14px 14px 14px;
            border: 1px solid #e3e6ea;
            flex: 1;
            min-height: 500px;
        }
        
        .basket-area-box {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1.5px 6px rgba(0,0,0,0.06);
            border: 1px solid #e3e6ea;
            width: 350px;
            min-width: 300px;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 600px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .basket-area-box.collapsed {
            width: 60px;
            min-width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .basket-area-box.collapsed:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        .basket-area-box.collapsed .basket-content,
        .basket-area-box.collapsed .basket-footer {
            display: none;
        }
        
        .basket-area-box.collapsed .basket-header {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .basket-area-box.collapsed .basket-header h3 {
            display: none;
        }
        
        .basket-area-box.collapsed .basket-toggle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            font-size: 18px;
            font-weight: bold;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .basket-area-box.collapsed .basket-toggle:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .basket-area-box.collapsed .basket-toggle::before {
            content: 'üõí';
            font-size: 20px;
        }
        
        .basket-area-box.collapsed .basket-toggle::after {
            content: attr(data-count);
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .search-area-title {
            text-align: center;
            font-size: 1.3em;
            font-weight: 700;
            color: #1a237e;
            letter-spacing: 0.01em;
            margin-bottom: 2px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            text-transform: none;
            padding: 0 0 1px 0;
            display: block;
        }
        .product-list-area-box {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1.5px 6px rgba(0,0,0,0.06);
            padding: 22px 14px 14px 14px;
            border: 1px solid #e3e6ea;
        }
        @media (min-width: 1600px) {
            .basket-area-box {
                width: 400px;
                min-width: 400px;
            }
        }
        
        @media (max-width: 1400px) {
            .basket-area-box {
                width: 320px;
                min-width: 280px;
            }
        }
        
        @media (max-width: 1200px) {
            .unified-interface-container {
                flex-direction: column;
                gap: 15px;
                padding: 0 10px;
            }
            
            .search-results-area {
                gap: 10px;
            }
            
            .basket-area-box {
                width: 100%;
                min-width: 100%;
                min-height: 500px;
            }
        }
        
        @media (max-width: 700px) {
            .search-area-box, .product-results-area {
                padding: 2px 1vw;
                border-radius: 8px;
            }
            
            .unified-interface-container {
                gap: 10px;
                padding: 0 5px;
            }
            
            .basket-area-box {
                min-height: 400px;
            }
            
            .product-results-area {
                min-height: 400px;
            }
            
            .product-table th, .product-table td {
                padding: 8px 4px;
                font-size: 0.9em;
            }
            
        .product-table td input.quantity-input {
                max-width: 80px;
                min-width: 60px;
                padding: 6px 8px;
            }
        }
        .product-table td input.quantity-input {
            width: 80px;
            padding: 6px 8px;
            border: 1.5px solid #e3e6ea;
            border-radius: 6px;
            font-size: 0.9em;
            margin-right: 4px;
            appearance: textfield;
            -moz-appearance: textfield;
            box-sizing: border-box;
        }
        /* Remove number input spinners for Chrome, Safari, Edge */
        .product-table td input.quantity-input::-webkit-outer-spin-button,
        .product-table td input.quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Remove number input spinners for Firefox */
        .product-table td input.quantity-input[type=number] {
            appearance: textfield;
            -moz-appearance: textfield;
        }
        
        /* Grid View Styles */
        .product-grid {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }
        
        .product-grid.active {
            display: grid;
        }
        
        .product-card {
            background: #fff;
            border: 1px solid #e3e6ea;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            border-color: #007bff;
        }
        
        .product-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 6px;
        }
        
        .product-image-placeholder {
            color: #6c757d;
            font-size: 48px;
            opacity: 0.5;
        }
        
        .product-code {
            font-size: 0.9em;
            color: #007bff;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .product-name {
            font-size: 1em;
            color: #333;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 12px;
            text-align: center;
            min-height: 2.8em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .product-status {
            text-align: center;
            margin-bottom: 16px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-badge.available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.unavailable {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.control {
            background: #fff3cd;
            color: #856404;
        }
        
        .add-to-basket-btn {
            width: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-to-basket-btn:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .add-to-basket-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .add-icon {
            font-size: 1.2em;
        }
        
        /* Responsive Grid Styles */
        @media (max-width: 1200px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 16px;
            }
        }
        
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 12px;
                padding: 16px 0;
            }
            
            .product-card {
                padding: 12px;
            }
            
            .product-image {
                height: 140px;
            }
            
            .product-name {
                font-size: 0.9em;
                min-height: 2.4em;
            }
            
            .add-to-basket-btn {
                padding: 10px 12px;
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 10px;
            }
            
            .product-card {
                padding: 10px;
            }
            
            .product-image {
                height: 120px;
            }
            
            .product-code {
                font-size: 0.8em;
            }
            
            .product-name {
                font-size: 0.85em;
                min-height: 2.2em;
            }
            
            .add-to-basket-btn {
                padding: 8px 10px;
                font-size: 0.85em;
            }
        }
        
        /* Quantity Popup Modal */
        .quantity-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            backdrop-filter: blur(4px);
        }
        
        .quantity-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .quantity-modal h3 {
            margin: 0 0 16px 0;
            color: #333;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .quantity-modal p {
            margin: 0 0 24px 0;
            color: #666;
            font-size: 1em;
            line-height: 1.5;
        }
        
        .quantity-input-group {
            margin-bottom: 24px;
        }
        
        .quantity-input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .quantity-input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e3e6ea;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            transition: border-color 0.3s ease;
        }
        
        .quantity-input-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .quantity-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .quantity-modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .quantity-modal-btn.primary {
            background: #007bff;
            color: white;
        }
        
        .quantity-modal-btn.primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .quantity-modal-btn.secondary {
            background: #6c757d;
            color: white;
        }
        
        .quantity-modal-btn.secondary:hover {
            background: #5a6268;
        }
        
        /* reCAPTCHA Modal Styles */
        .recaptcha-modal {
            display: none;
            position: fixed;
            z-index: 99999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .recaptcha-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .recaptcha-modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            z-index: 100000;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .recaptcha-modal h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .recaptcha-modal p {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .recaptcha-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .recaptcha-modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        .recaptcha-modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .recaptcha-modal-btn.primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }
        
        .recaptcha-modal-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
            transform: translateY(-2px);
        }
        
        .recaptcha-modal-btn.primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .recaptcha-modal-btn.secondary {
            background: #6c757d;
            color: white;
        }
        
        .recaptcha-modal-btn.secondary:hover {
            background: #5a6268;
        }
        
        /* Ensure reCAPTCHA modal appears above everything */
        .recaptcha-modal * {
            position: relative;
            z-index: 100001;
        }
        
        /* Force modal to be on top */
        body.recaptcha-modal-open {
            overflow: hidden;
        }
        
        /* Order Confirmation Screen Styles */
        .order-confirmation-screen {
            display: none;
            position: fixed;
            z-index: 99999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            backdrop-filter: blur(10px);
        }
        
        .order-confirmation-screen.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .order-confirmation-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideInUp 0.6s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .confirmation-icon {
            font-size: 4em;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-20px);
            }
            60% {
                transform: translateY(-10px);
            }
        }
        
        .order-confirmation-content h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 2.2em;
            font-weight: 700;
        }
        
        .order-confirmation-content p {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .confirmation-details {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .confirmation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .confirmation-item:last-child {
            border-bottom: none;
        }
        
        .confirmation-label {
            font-weight: 600;
            color: #495057;
        }
        
        .confirmation-value {
            color: #007bff;
            font-weight: 700;
        }
        
        .confirmation-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .confirmation-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .confirmation-btn.primary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .confirmation-btn.primary:hover {
            background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .confirmation-btn.secondary {
            background: #6c757d;
            color: white;
        }
        
        .confirmation-btn.secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }
        
        @media (max-width: 768px) {
            .order-confirmation-content {
                padding: 30px 20px;
                margin: 20px;
            }
            
            .confirmation-actions {
                flex-direction: column;
            }
            
            .confirmation-btn {
                width: 100%;
            }
        }
        /* --- Page Header --- */
        .rfq-header {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            margin: 20px 0 20px 0;
            position: relative;
            gap: 15px;
            min-height: 80px;
        }
        .rfq-header-logo {
            max-width: 60px;
            width: 100%;
            height: auto;
            margin-bottom: 0;
        }
        .rfq-header-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #1a237e;
            letter-spacing: 0.01em;
            margin-bottom: 0;
            text-align: center;
        }
        .rfq-lang-topright {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .btn-help {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            min-width: 60px;
        }

        .btn-help:hover {
            background: #5a6268;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .help-text {
            font-size: 14px;
            line-height: 1;
            white-space: nowrap;
        }
        
        @media (max-width: 900px) {
            .rfq-header {
                min-height: 90px;
            }
            .rfq-lang-topright {
                top: 10px;
                right: 15px;
            }
        }
        @media (max-width: 600px) {
            .rfq-header {
                flex-direction: column;
                gap: 8px;
                margin: 15px 0 15px 0;
                min-height: 100px;
            }
            .rfq-header-logo {
                max-width: 50px;
            }
            .rfq-header-title {
                font-size: 1.4em;
            }
            .rfq-lang-topright {
                position: static;
                flex-direction: row;
                justify-content: center;
                margin-top: 8px;
                gap: 12px;
            }
            .catalog-button-container {
                margin-top: 4px;
            }
        }

        /* Language Selection Styles */
        .language-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 20px;
            margin: 0;
            border-radius: 0;
            text-align: center;
            box-shadow: none;
            min-height: 100vh;
            display: none; /* Hidden by default */
            z-index: 10000;
        }
        
        .language-selection[style*="display: block"] {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .language-selection[style*="display: block"] ~ .rfq-header {
            display: none !important;
        }

        .language-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .language-selection h2 {
            font-size: 2.8em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .language-selection p {
            font-size: 1.3em;
            margin-bottom: 50px;
            opacity: 0.9;
        }

        .language-options {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .language-option {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .language-option:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .language-option img {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .language-name {
            font-size: 1.2em;
            font-weight: 600;
            color: white;
        }

        @media (max-width: 768px) {
            .language-options {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .language-selection h2 {
                font-size: 2.2em;
            }
            
            .language-option {
                min-width: 200px;
            }
        }

        /* Welcome Section Styles */
        .welcome-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0;
            margin: 0;
            border-radius: 0;
            text-align: center;
            box-shadow: none;
            display: none; /* Hidden by default */
            z-index: 10000;
            backdrop-filter: blur(4px);
            overflow-y: auto;
        }
        
        .welcome-section[style*="display: block"] {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }
        
        .welcome-section[style*="display: block"] ~ .rfq-header {
            display: none !important;
        }
        
        .welcome-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .welcome-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .welcome-dont-show {
            margin-top: 25px;
            text-align: center;
        }
        
        .dont-show-checkbox {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            font-size: 0.95em;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }
        
        .dont-show-checkbox:hover {
            opacity: 1;
        }
        
        .dont-show-checkbox input[type="checkbox"] {
            display: none;
        }
        
        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.7);
            border-radius: 4px;
            background: transparent;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .dont-show-checkbox input[type="checkbox"]:checked + .checkmark {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.9);
        }
        
        .dont-show-checkbox input[type="checkbox"]:checked + .checkmark::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        /* Mobile responsive for welcome popup */
        @media (max-width: 768px) {
            .welcome-section[style*="display: block"] {
                display: block !important;
                align-items: flex-start;
                justify-content: flex-start;
                padding: 20px 0;
            }
            
            .welcome-content {
                max-width: 95%;
                padding: 30px 20px;
                margin: 20px auto;
                position: relative;
                top: auto;
                left: auto;
                transform: none;
            }
            
            .welcome-section h2 {
                font-size: 2em;
            }
            
            .welcome-section p {
                font-size: 1.1em;
            }
        }

        .welcome-content {
            max-width: 600px;
            width: 90%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin: 0 auto;
            position: relative;
            animation: welcomeSlideIn 0.4s ease-out;
        }
        
        @keyframes welcomeSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .welcome-section h2 {
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .welcome-section p {
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .steps-container {
            display: flex;
            justify-content: space-between;
            margin: 40px 0;
            gap: 20px;
        }

        .step-item {
            flex: 1;
            background: rgba(255,255,255,0.1);
            padding: 30px 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .step-item:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
        }

        .step-number {
            width: 50px;
            height: 50px;
            background: #fff;
            color: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 auto 20px;
        }

        .step-content h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .step-content p {
            font-size: 0.95em;
            opacity: 0.8;
            margin: 0;
        }

        .welcome-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .btn-large:hover .btn-icon {
            transform: translateX(5px);
        }


        @media (max-width: 768px) {
            .steps-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .welcome-section h2 {
                font-size: 2em;
            }
            
            .welcome-actions {
                flex-direction: column;
                align-items: center;
                gap: 15px;
                margin-top: 30px;
            }
            
            .welcome-dont-show {
                margin-top: 20px;
                text-align: center;
            }
        }

        /* Help Modal Styles */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .help-modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            border-radius: 15px 15px 0 0;
        }

        .help-modal-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.5em;
        }

        .help-close {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .help-close:hover {
            background: #e9ecef;
        }

        .help-modal-body {
            padding: 30px;
        }

        .help-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #007bff;
        }

        .help-section h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.2em;
        }

        .help-section p {
            margin: 0;
            color: #666;
            line-height: 1.6;
        }

        .help-tips {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .help-tips h4 {
            margin: 0 0 15px 0;
            color: #856404;
        }

        .help-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .help-tips li {
            margin-bottom: 8px;
            color: #856404;
        }

        .help-modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            background: #f8f9fa;
            border-radius: 0 0 15px 15px;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10001;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-left: 4px solid #28a745;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: #dc3545;
        }

        .notification.warning {
            border-left-color: #ffc107;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
            color: #333;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }

        .notification-message {
            color: #666;
            line-height: 1.5;
        }

        /* Mobile Improvements */
        @media (max-width: 768px) {
            .notification {
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .floating-cart-btn {
                bottom: 20px;
                right: 20px;
                min-width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
            
            .cart-panel {
                bottom: 80px;
                right: 20px;
                left: 20px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Main Page Header -->
    <div class="rfq-header">
        <img src="http://dogukanlevent.com/RFQ-Web/PH-Header.png" alt="Logo" class="rfq-header-logo" />
        <div class="rfq-header-title" id="headerTitle">HMK RFQ Portal</div>
        <div class="rfq-lang-topright">
            <div id="langButtons" style="display:flex; gap:6px; align-items:center;">
                <button type="button" class="btn btn-secondary btn-help" id="btnHelp" onclick="showWelcomeScreen()" title="Help & Guide">
                    <span class="help-text" id="helpButtonText">Help</span>
                </button>
                <div class="view-toggle-container">
                    <button type="button" class="btn btn-secondary view-toggle-btn active" id="listViewBtn" onclick="switchView('list')" title="List View">
                        <span class="view-icon">‚ò∞</span>
                    </button>
                    <button type="button" class="btn btn-secondary view-toggle-btn" id="gridViewBtn" onclick="switchView('grid')" title="Grid View">
                        <span class="view-icon">‚äû</span>
                    </button>
                </div>
                <button type="button" class="btn btn-primary btn-lang" id="btnLangTrTop" onclick="setLanguage('tr')" title="T√ºrk√ße">
                    <img src="https://flagcdn.com/24x18/tr.png" width="24" height="18" alt="TR" loading="lazy" />
                </button>
                <button type="button" class="btn btn-primary btn-lang" id="btnLangEnTop" onclick="setLanguage('en')" title="English (GB)">
                    <img src="https://flagcdn.com/24x18/gb.png" width="24" height="18" alt="GB" loading="lazy" />
                </button>
            </div>
            
            <!-- Digital Catalog Button -->
            <div class="catalog-button-container">
                <button type="button" class="btn btn-catalog" id="catalogBtn" onclick="openDigitalCatalog()" title="View Digital Catalog">
                    <span class="catalog-icon">üìñ</span>
                    <span id="catalogBtnText">View Digital Catalog</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Language Selection Screen -->
    <div class="language-selection" id="languageSelection">
        <div class="language-content">
            <h2 id="languageSelectionTitle">Choose Your Language</h2>
            <p id="languageSelectionSubtitle">Please select your preferred language to continue</p>
            
            <div class="language-options">
                <button class="language-option" onclick="selectLanguage('tr')" id="langOptionTr">
                    <img src="https://flagcdn.com/48x36/tr.png" width="48" height="36" alt="Turkey" />
                    <span class="language-name" id="langNameTr">T√ºrk√ße</span>
                </button>
                <button class="language-option" onclick="selectLanguage('en')" id="langOptionEn">
                    <img src="https://flagcdn.com/48x36/gb.png" width="48" height="36" alt="United Kingdom" />
                    <span class="language-name" id="langNameEn">English</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Welcome Section -->
    <div class="welcome-section" id="welcomeSection" onclick="closeWelcomeModal(event)">
        <div class="welcome-content" onclick="event.stopPropagation()">
            <button class="welcome-close-btn" onclick="closeWelcomeModal()" title="Close">&times;</button>
            <h2 id="welcomeTitle">Welcome</h2>
            <p id="welcomeSubtitle">Create your quote request in just 3 simple steps</p>
            
            <div class="steps-container">
                <div class="step-item" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3 id="step1Title">Browse Products</h3>
                        <p id="step1Desc">Search and filter our product catalog to find what you need</p>
                    </div>
                </div>
                <div class="step-item" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3 id="step2Title">Add to Cart</h3>
                        <p id="step2Desc">Select quantities and add products to your quote request</p>
                    </div>
                </div>
                <div class="step-item" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3 id="step3Title">Submit Request</h3>
                        <p id="step3Desc">Fill in your details and send us your quote request</p>
                    </div>
                </div>
            </div>
            
            <div class="welcome-actions">
                <button class="btn btn-primary btn-large" onclick="startShopping()" id="startBtn">
                    <span id="startBtnText">Start Shopping</span>
                    <span class="btn-icon">‚Üí</span>
                </button>
                <button class="btn btn-secondary" onclick="showHelp()" id="helpBtn">
                    <span id="helpBtnText">Need Help?</span>
                </button>
            </div>
            
            <div class="welcome-dont-show">
                <label class="dont-show-checkbox">
                    <input type="checkbox" id="dontShowWelcome" onchange="toggleDontShowWelcome()">
                    <span class="checkmark"></span>
                    <span id="dontShowText">Don't show this again</span>
                </label>
            </div>
            
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div>
            <div class="loading-spinner"></div>
            <p style="margin-top: 20px;" id="loadingText">Loading products...</p>
        </div>
    </div>
    
    <!-- Page Container with Sidebar Layout -->
    <div class="page-container">
        <!-- Main Content Area -->
        <div class="main-content-area">
            <!-- Alternative Product Suggestion Modal -->
    <div id="alternativeModal" class="alternative-modal">
        <div class="alternative-content">
            <div class="alternative-header">
                <span class="alternative-icon">üí°</span>
                <h3>Alternative Product Suggestions</h3>
            </div>
            
            <div id="alternativeProductInfo" class="alternative-product-info">
                <div class="product-name" id="modalProductName">Product Name</div>
                <div class="product-status" id="modalProductStatus">Status</div>
            </div>
            
            <div class="alternative-options">
                <h4>Would you like us to suggest alternatives?</h4>
                <div class="selected-count" id="selectedCount">Select your preferences (0/5) - You can choose multiple alternatives OR "Remove if Unavailable"</div>
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 8px; margin-bottom: 15px; font-size: 12px; color: #856404;">
                    <strong>Note:</strong> "Remove if Unavailable" is mutually exclusive with alternative options. Choose either alternatives OR removal.
                </div>
                <div class="option-grid">
                    <div class="option-item" data-option="color" onclick="toggleOption(this)">
                        <span class="option-icon">üé®</span>
                        <div class="option-title">Different Color</div>
                        <div class="option-description">Find the same product in alternative colors</div>
                    </div>
                    <div class="option-item" data-option="size" onclick="toggleOption(this)">
                        <span class="option-icon">üìè</span>
                        <div class="option-title">Different Size</div>
                        <div class="option-description">Find the same product in different dimensions</div>
                    </div>
                    <div class="option-item" data-option="similar-size" onclick="toggleOption(this)">
                        <span class="option-icon">‚öñÔ∏è</span>
                        <div class="option-title">Similar Size</div>
                        <div class="option-description">Find products with comparable dimensions</div>
                    </div>
                    <div class="option-item" data-option="similar-product" onclick="toggleOption(this)">
                        <span class="option-icon">üîÑ</span>
                        <div class="option-title">Similar Product & Solution</div>
                        <div class="option-description">Find alternative products that serve the same purpose</div>
                    </div>
                    <div class="option-item remove-option" data-option="remove" onclick="toggleOption(this)">
                        <span class="option-icon">‚ùå</span>
                        <div class="option-title">Remove if Unavailable</div>
                        <div class="option-description">Remove this product from quote if alternatives are not wanted</div>
                    </div>
                </div>
            </div>
            
            <div class="alternative-actions">
                <button class="btn btn-secondary" onclick="closeAlternativeModal()">Skip</button>
                <button class="btn btn-primary" onclick="submitAlternativeRequest()" id="submitAlternativeBtn" disabled>Request Alternatives</button>
            </div>
        </div>
    </div>
    
    <!-- MOQ Exception Modal -->
    <div id="moqModal" class="alternative-modal">
        <div class="alternative-content">
            <div class="alternative-header">
                <span class="alternative-icon">‚ö†Ô∏è</span>
                <h3 id="moqModalTitle">MOQ Exception Request</h3>
            </div>
            <div id="moqModalInfo" class="alternative-product-info">
                <div class="product-name" id="moqModalProductName">Product Name</div>
                <div class="product-status" id="moqModalStatus">MOQ: <span id="moqModalMOQ"></span> | Your Request: <span id="moqModalRequested"></span></div>
            </div>
            <div style="margin-bottom: 18px; color: #856404; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; padding: 10px; font-size: 13px;">
                <span id="moqModalInfoText">This product has a Minimum Order Quantity (MOQ) of</span> <b id="moqModalMOQ2"></b> <span id="moqModalNoteText">adet.</span><br>
                <span id="moqModalChooseText">Please choose an option below:</span>
            </div>
            <div class="option-grid">
                <div class="option-item" id="moqOptionStock" onclick="selectMOQOption('stock')">
                    <span class="option-icon">üì¶</span>
                    <div class="option-title" id="moqOptionStockTitle">Offer me any amount in your stock if there's any</div>
                    <div class="option-description" id="moqOptionStockDesc">We'll check our stock and quote you for the available quantity if less than MOQ.</div>
                </div>
                <div class="option-item" id="moqOptionMOQ" onclick="selectMOQOption('moq')">
                    <span class="option-icon">‚¨ÜÔ∏è</span>
                    <div class="option-title" id="moqOptionMOQTitle">Increase quantity to MOQ and offer</div>
                    <div class="option-description" id="moqOptionMOQDesc">We'll increase your order to the MOQ (<span id="moqModalMOQ3"></span> adet) and quote you accordingly.</div>
                </div>
            </div>
            <div class="alternative-actions">
                <button class="btn btn-secondary" onclick="closeMOQModal()" id="moqModalCancelBtn">Cancel</button>
                <button class="btn btn-primary" id="moqModalProceedBtn" onclick="proceedMOQModal()" disabled>Proceed</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Error/Success Messages -->
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>

        <!-- Unified Interface: Search, Results, and Basket -->
        <div class="unified-interface-container">
            <!-- Left Side: Search and Results -->
            <div class="search-results-area">
                <!-- Search Area -->
        <div class="search-area-box">
            <div class="search-area-title">SEARCH</div>
            <div class="filters">
                <!-- Language buttons moved to header top-right -->
                <div class="filter-group">
                            <input type="text" id="searchInput" placeholder="Search by code or description..." onkeyup="filterProducts()" style="width:100%; max-width:400px; min-width: 300px;">
                </div>
                <div class="filter-group">
                    <select id="mainCategoryFilter" onchange="onMainCategoryChange()">
                        <option value="">All Main Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                    <select id="subCategoryFilter" onchange="filterProducts()" disabled>
                        <option value="">All Sub Categories</option>
                    </select>
                </div>
                <div class="filter-group">
                            <input type="number" id="catalogPageInput" placeholder="Catalog page number..." onkeyup="filterProducts()" onchange="filterProducts()" style="width:100%; max-width:250px;">
                </div>
                <div class="filter-group" style="min-width: 200px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; background: white; border: 1px solid #ddd; border-radius: 4px; padding: 4px 8px; height: 28px;">
                        <input type="checkbox" id="noMoqFilter" onchange="filterProducts()" style="width: auto; margin: 0; transform: scale(1.2);">
                        <span style="font-size: 0.9em; font-weight: bold; color: #333;" id="noMoqText">Without MOQ</span>
                    </div>
                </div>
            </div>
        </div>

                <!-- Product Results Area -->
                <div class="product-results-area">
            <!-- Product Count -->
            <div class="product-count" id="productCount">Showing 0 products</div>
            <!-- Centered Pagination Controls (top, above table) -->
            <div class="pagination-controls pagination-controls-top" style="margin: 18px 0 18px 0; display: flex; align-items: center; gap: 16px; flex-wrap: wrap; justify-content: center;">
                <button class="btn btn-primary" onclick="changePage(-1)" id="prevBtn" disabled>¬´</button>
                <span id="pageInfo" style="font-weight: bold;"></span>
                <button class="btn btn-primary" onclick="changePage(1)" id="nextBtn">¬ª</button>
            </div>
            <!-- Products Table -->
                    <div style="overflow-x: auto; overflow-y: visible; max-width: 100%;">
                <table class="product-table" id="productsTable">
                    <thead>
                        <tr>
                            <th id="thCode">Product Code</th>
                            <th id="thDesc">Description</th>
                            <th id="thStatus">Status</th>
                            <th id="thPackQty">Pack Qty</th>
                            <th id="thQuantity">Qty</th>
                            <th id="thAction">Action</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
            </div>
                    
                    <!-- Product Grid (hidden by default) -->
                    <div class="product-grid" id="productGrid">
                        <!-- Product cards will be loaded here -->
                    </div>
                    
            <!-- Pagination Controls (bottom) -->
            <div class="pagination-controls pagination-controls-bottom" style="margin: 18px 0 0 0; display: flex; align-items: center; gap: 16px; flex-wrap: wrap; justify-content: center !important; text-align: center;">
                <button class="btn btn-primary" onclick="changePage(-1)" id="prevBtnBottom" disabled>¬´</button>
                <span id="pageInfoBottom" style="font-weight: bold;"></span>
                <button class="btn btn-primary" onclick="changePage(1)" id="nextBtnBottom">¬ª</button>
                <label for="productsPerPage" id="pppLabel" style="margin-left: 12px; margin-bottom:0;">Products per page: </label>
                <select id="productsPerPage" onchange="changeProductsPerPage()" style="margin-left: 4px; margin-bottom:0;">
                    <option value="10" selected>10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
                    </div>
                </div>
            </div>
            
            <!-- Right Side: Basket -->
            <div class="basket-area-box" id="basketContainer">
                <div class="basket-header">
                    <div>
                        <h3>üõí <span id="basketTitle">Request List</span> (<span id="basketItemCount">0</span>)</h3>
                    </div>
                    <button class="basket-toggle" onclick="toggleBasket()" id="basketToggle" title="Collapse Basket"></button>
                </div>
                <div class="basket-content" id="basketContent">
                    <!-- Items will be rendered here -->
                </div>
                <div class="basket-footer">
                    <div class="cart-summary">
                        <span class="cart-summary-label" id="basketTotalLabel">Total Items:</span>
                        <span class="cart-summary-value" id="basketTotalItems">0</span>
                    </div>
                    <div class="cart-actions">
                        <button class="btn btn-primary" onclick="scrollToCustomerForm()" id="proceedBtn">Proceed to Request</button>
                        <button class="btn btn-secondary" onclick="clearBasket()" id="clearAllBtn">Clear All</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Customer Info Modal (hidden by default) -->
        <div id="customerInfoModal" class="alternative-modal" style="z-index:20000;">
          <div class="alternative-content" style="max-width:95vw; width:auto; max-height:95vh; height:auto;">
            <!-- Step 1: Order Summary -->
            <div id="checkoutStepSummary">
              <div class="alternative-header">
                <span class="alternative-icon">üì¶</span>
                <h3 id="orderSummaryTitle">${t('orderSummary')}</h3>
                <button class="modal-close-btn" onclick="closeCustomerInfoModal()" title="Close">&times;</button>
              </div>
              <div class="order-summary-card" style="margin-top:0;">
                <div id="orderSummaryBodyModal"></div>
              </div>
              <div class="order-form-actions" style="margin-top:18px;">
                <button type="button" class="btn-modern" style="background:#dc3545;" onclick="closeCustomerInfoModal()" id="backToBasketBtn">Back to Request List</button>
                <button type="button" class="btn-modern" onclick="showCustomerInfoStep()" id="continueToCustomerBtn">Continue to Customer Info</button>
              </div>
            </div>
            <!-- Step 2: Customer Info Form -->
            <div id="checkoutStepCustomer" style="display:none;">
              <div class="alternative-header">
                <span class="alternative-icon">üìù</span>
                <h3 id="customerInfoTitle">Customer Information & Order Finalization</h3>
                <button class="modal-close-btn" onclick="closeCustomerInfoModal()" title="Close">&times;</button>
              </div>
              <form id="customerForm" class="customer-form-modern" style="margin-bottom:0;">
                <div class="form-group-modern">
                  <input type="text" name="orderNumber" id="inputOrderNumber" placeholder="" autocomplete="off" />
                  <span class="input-icon">#Ô∏è‚É£</span>
                  <label for="inputOrderNumber" id="labelOrderNumber">Order Number (If applicable)</label>
                </div>
                <div class="form-group-modern">
                  <input type="text" name="company" id="inputCompany" required placeholder="" autocomplete="organization" />
                  <span class="input-icon">üè¢</span>
                  <label for="inputCompany" id="labelCompanyName">Company Name *</label>
                </div>
                <div class="form-group-modern">
                  <input type="text" name="contact" id="inputContact" required placeholder="" autocomplete="name" />
                  <span class="input-icon">üë§</span>
                  <label for="inputContact" id="labelContactPerson">Contact Person *</label>
                </div>
                <div class="form-group-modern">
                  <input type="email" name="email" id="inputEmail" required placeholder="" autocomplete="email" />
                  <span class="input-icon">‚úâÔ∏è</span>
                  <label for="inputEmail" id="labelEmail">Email *</label>
                </div>
                <div class="form-group-modern">
                  <input type="tel" name="inputPhone" id="inputPhone" placeholder="" autocomplete="tel" />
                  <span class="input-icon">üìû</span>
                  <label for="inputPhone" id="labelPhone">Phone</label>
                </div>
                <div class="form-group-modern" style="grid-column: 1/-1;">
                  <textarea name="notes" id="inputNotes" placeholder="" autocomplete="off"></textarea>
                  <span class="input-icon">üìù</span>
                  <label for="inputNotes" id="labelAdditionalNotes">Additional Notes</label>
                </div>
                <div class="order-form-actions">
                  <button type="button" class="btn-modern" style="background:#dc3545;" onclick="showOrderSummaryStep()" id="backToSummaryBtn">Back to Summary</button>
                  <button type="submit" class="btn-modern" id="submitOrderBtn"><span>Send Request</span> <span>üìß</span></button>
                </div>
              </form>
            </div>
          </div>
        </div>
    </div>
    
    <script>
        let products = [];
        let orderItems = [];
        let allProducts = []; // Store all products for filtering
        let currentLanguage = 'tr'; // 'tr' or 'en'
        let isFirstVisit = true; // Track if this is user's first visit
        
        // Pagination variables
        let currentPage = 1;
        let productsPerPage = 10; // Show 10 products per page by default
        let filteredProducts = []; // Store filtered results for pagination
        
        // Basket state
        let basketCollapsed = false;
        
        // Alternative product suggestion state
        let selectedAlternatives = [];
        let currentAlternativeProduct = null;
        
        // Path to your CSV files on the server
        const CSV_FILE_PATH = 'products.csv';
        const CATEGORIES_FILE_PATH = 'categories.csv';
        
        // Load products and categories when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // For testing: Clear localStorage to always show language selection
            // localStorage.clear();
            
            // Initialize floating labels
            initializeFloatingLabels();
            
            // Check if user has already selected a language
            const selectedLanguage = localStorage.getItem('rfq_selected_language');
            const firstVisit = localStorage.getItem('rfq_first_visit');
            
            // For testing: Add a way to force show welcome screen
            // You can add ?show_welcome=true to the URL to force show it
            const urlParams = new URLSearchParams(window.location.search);
            const forceShowWelcome = urlParams.get('show_welcome') === 'true';
            
            // Hide all sections initially
            const mainContent = document.querySelector('.main-content-area');
            const welcomeSection = document.getElementById('welcomeSection');
            const languageSelection = document.getElementById('languageSelection');
            
            console.log('Initializing sections...');
            console.log('Selected language:', selectedLanguage);
            console.log('First visit:', firstVisit);
            
            if (mainContent) {
                mainContent.style.display = 'none';
                console.log('Main content hidden');
            }
            if (welcomeSection) {
                welcomeSection.style.display = 'none';
                console.log('Welcome section hidden');
            }
            if (languageSelection) {
                languageSelection.style.display = 'none';
                console.log('Language selection hidden');
            }
            
            if (forceShowWelcome) {
                // Force show welcome screen for testing
                console.log('Force showing welcome screen');
                isFirstVisit = true;
                if (welcomeSection) {
                    welcomeSection.style.display = 'block';
                    console.log('Welcome section shown');
                }
            } else if (selectedLanguage) {
                // User has selected language - check if welcome should be shown
                const dontShowWelcome = localStorage.getItem('rfq_dont_show_welcome');
                console.log('User has selected language, dontShowWelcome:', dontShowWelcome);
                
                if (dontShowWelcome === 'true') {
                    // Skip welcome screen, go directly to main content
                    console.log('Skipping welcome screen, going to main content');
                isFirstVisit = false;
                setLanguage(selectedLanguage);
                if (mainContent) {
                    mainContent.style.display = 'block';
                    }
                    const header = document.querySelector('.rfq-header');
                    if (header) {
                        header.style.display = 'flex';
                    }
                } else {
                    // Show welcome screen
                    console.log('Showing welcome screen');
                    isFirstVisit = true;
                    setLanguage(selectedLanguage);
                    if (welcomeSection) {
                        welcomeSection.style.display = 'block';
                        console.log('Welcome section shown');
                    }
                    // Hide header when showing welcome screen
                    const header = document.querySelector('.rfq-header');
                    if (header) {
                        header.style.display = 'none';
                    }
                }
            } else {
                // First time user - show language selection
                console.log('First time user, showing language selection');
                isFirstVisit = true;
                if (languageSelection) {
                    languageSelection.style.display = 'block';
                    console.log('Language selection shown');
                }
                // Hide header when showing language selection
                const header = document.querySelector('.rfq-header');
                if (header) {
                    header.style.display = 'none';
                }
            }

            // Load data with caching
            loadDataWithCache();
        });

        // Enhanced data loading with caching
        async function loadDataWithCache() {
            const cacheKey = 'rfq_data_cache';
            const cacheTime = 5 * 60 * 1000; // 5 minutes cache
            
            // Show loading overlay
            showLoading();
            
            try {
                // Check cache first
                const cached = localStorage.getItem(cacheKey);
                console.log('Cache check - cached data exists:', !!cached);
                if (cached) {
                    const { data, timestamp } = JSON.parse(cached);
                    const cacheAge = Date.now() - timestamp;
                    console.log('Cache age:', cacheAge, 'ms, cache time limit:', cacheTime, 'ms');
                    if (cacheAge < cacheTime) {
                        console.log('Using cached data');
                        // Use cached data
                        products = data.products || [];
                        allProducts = data.products || [];
                        categoriesMain = data.categoriesMain || [];
                        categoriesSub = data.categoriesSub || [];
                        console.log('Cached categories - Main:', categoriesMain.length, 'Sub:', categoriesSub.length);
                        populateCategoryFilters();
                        hideLoading();
                        
                        // Ensure main content is visible after loading from cache
                        const mainContent = document.querySelector('.main-content-area');
                        if (mainContent) {
                            mainContent.style.display = 'block';
                        }
                        return;
                    } else {
                        console.log('Cache expired, loading fresh data');
                    }
                } else {
                    console.log('No cache found, loading fresh data');
                }
                
                // Load fresh data
                console.log('Starting to load fresh data...');
                await Promise.all([
                    loadProductsFromServer(),
                    loadCategoriesFromServer()
                ]);
                console.log('Fresh data loading completed');
                
                // Cache the data
                localStorage.setItem(cacheKey, JSON.stringify({
                    data: { 
                        products: allProducts,
                        categoriesMain: categoriesMain,
                        categoriesSub: categoriesSub
                    },
                    timestamp: Date.now()
                }));
                
                populateCategoryFilters();
            } catch (error) {
                console.error('Error loading data:', error);
                populateCategoryFilters();
            }
        }
        
        // Load products from server
        async function loadProductsFromServer() {
            try {
                console.log('Loading products from:', CSV_FILE_PATH);
                
                // Add timeout to prevent hanging
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
                
                const response = await fetch(CSV_FILE_PATH, {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    console.error('Failed to load CSV file:', response.status, response.statusText);
                    throw new Error(`Failed to load product data: ${response.status} ${response.statusText}`);
                }
                
                const text = await response.text();
                console.log('CSV loaded, size:', text.length);
                console.log('CSV content preview:', text.substring(0, 200));
                
                // Parse all products
                const parsedRows = parseCSV(text);
                console.log('Parsed rows count:', parsedRows.length);
                products = parsedRows
                    .map(normalizeProductFromNewSchema)
                    .filter(p => (p.catalog_id || p.product_code || '').trim().length > 0)
                    .filter((p, idx, arr) => {
                        // Deduplicate by catalog_id/product_code
                        const key = (p.catalog_id || p.product_code).trim();
                        if (!key) return false;
                        return arr.findIndex(x => (x.catalog_id || x.product_code).trim() === key) === idx;
                    });
                allProducts = [...products];
                
                console.log('Products parsed:', products.length);
                console.log('First few products:', products.slice(0, 3));
                
                populateFilters();
                displayProducts(); // This will now show the "start searching" message
                hideLoading();
                
                // Ensure main content is visible after loading
                const mainContent = document.querySelector('.main-content-area');
                if (mainContent) {
                    mainContent.style.display = 'block';
                }
                
                showMessage(`Loaded ${products.length} products successfully!`, 'success');
                
            } catch (error) {
                console.error('Error loading data:', error);
                hideLoading();
                
                // Ensure main content is visible even on error
                const mainContent = document.querySelector('.main-content-area');
                if (mainContent) {
                    mainContent.style.display = 'block';
                }
                
                // Show a more helpful error message
                if (error.name === 'AbortError') {
                    showMessage('Loading timed out. Please check your internet connection and try refreshing the page.', 'error');
                } else if (error.message.includes('404')) {
                    showMessage('Product data file not found. Please contact support.', 'error');
                } else {
                    showMessage('Error loading products: ' + error.message, 'error');
                }
            }
        }

        // Categories data
        let categoriesMain = []; // [{code, tr, en}]
        let categoriesSub = [];  // [{code, tr, en, parent}]

        async function loadCategoriesFromServer() {
            try {
                console.log('Loading categories from:', CATEGORIES_FILE_PATH);
                const response = await fetch(CATEGORIES_FILE_PATH);
                if (!response.ok) throw new Error('Failed to load categories');
                const text = await response.text();
                console.log('Categories CSV loaded, size:', text.length);
                console.log('Categories CSV content preview:', text.substring(0, 200));
                parseCategoriesCSV(text);
                console.log('Categories loaded - Main:', categoriesMain.length, 'Sub:', categoriesSub.length);
                console.log('First few main categories:', categoriesMain.slice(0, 3));
            } catch (e) {
                console.error('Categories not loaded:', e.message);
            }
        }

        function parseCategoriesCSV(text) {
            console.log('Parsing categories CSV...');
            const lines = text.split('\n').map(l => l.trim());
            console.log('Total lines in CSV:', lines.length);
            let mode = 'main';
            categoriesMain = [];
            categoriesSub = [];
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                if (!line) continue;
                const cols = line.split(';');
                // Detect header switches based on header names
                if (/^alt kategori/i.test(cols[0])) { 
                    console.log('Switching to sub category mode at line', i);
                    mode = 'sub'; 
                    continue; 
                }
                if (/^kategori/i.test(cols[0]) && /adƒ±/i.test(cols[1] || '')) { 
                    console.log('Switching to main category mode at line', i);
                    mode = 'main'; 
                    continue; 
                }
                if (/^;+$/.test(line)) continue; // blank marker lines like ';;'

                if (mode === 'main') {
                    const code = (cols[0] || '').trim();
                    const tr = (cols[1] || '').trim();
                    const en = (cols[2] || '').trim();
                    if (code) {
                        categoriesMain.push({ code, tr, en });
                        console.log('Added main category:', code, tr, en);
                    }
                } else {
                    const code = (cols[0] || '').trim(); // e.g., 01.1
                    const tr = (cols[1] || '').trim();
                    const en = (cols[2] || '').trim();
                    if (!code) continue;
                    const parent = code.split('.')[0];
                    categoriesSub.push({ code, tr, en, parent });
                    console.log('Added sub category:', code, tr, en, 'parent:', parent);
                }
            }
            console.log('Categories parsing completed - Main:', categoriesMain.length, 'Sub:', categoriesSub.length);
        }

        function getCategoryLabel(code) {
            const item = categoriesMain.find(c => c.code === code);
            if (!item) return code;
            return currentLanguage === 'en' ? (item.en || item.tr || code) : (item.tr || item.en || code);
        }

        function getSubCategoryLabel(code) {
            const item = categoriesSub.find(c => c.code === code);
            if (!item) return code;
            return currentLanguage === 'en' ? (item.en || item.tr || code) : (item.tr || item.en || code);
        }
        
        // Robust CSV parser for semicolon-separated files with quotes and newlines
        function parseCSV(text) {
            // Normalize line endings
            text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const rows = [];
            let currentField = '';
            let currentRow = [];
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const next = text[i + 1];
                if (inQuotes) {
                    if (char === '"') {
                        if (next === '"') {
                            // Escaped quote
                            currentField += '"';
                            i++;
                        } else {
                            inQuotes = false;
                        }
                    } else {
                        currentField += char;
                    }
                } else {
                    if (char === '"') {
                        inQuotes = true;
                    } else if (char === ';') {
                        currentRow.push(currentField.trim());
                        currentField = '';
                    } else if (char === '\n') {
                        currentRow.push(currentField.trim());
                        currentField = '';
                        // Trim trailing empty fields from excessive semicolons
                        while (currentRow.length > 0 && currentRow[currentRow.length - 1] === '') {
                            currentRow.pop();
                        }
                        rows.push(currentRow);
                        currentRow = [];
                    } else {
                        currentField += char;
                    }
                }
            }
            // Flush last field/row if any
            if (currentField.length > 0 || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                while (currentRow.length > 0 && currentRow[currentRow.length - 1] === '') {
                    currentRow.pop();
                }
                rows.push(currentRow);
            }

            if (rows.length === 0) return [];
            const headers = (rows[0] || []).map(h => String(h || '').trim().replace(/^\"|\"$/g, '').toLowerCase());
            const data = [];
            for (let i = 1; i < rows.length; i++) {
                const values = rows[i] || [];
                // Skip rows that are fully empty
                const nonEmpty = values.some(v => String(v || '').trim() !== '');
                if (!nonEmpty) continue;
                const rowObj = {};
                for (let j = 0; j < headers.length; j++) {
                    rowObj[headers[j]] = (values[j] !== undefined ? String(values[j]).replace(/^\"|\"$/g, '') : '');
                }
                data.push(rowObj);
            }
            return data;
        }

        // Normalize a CSV row from the new schema into the application's product shape
        function normalizeProductFromNewSchema(row) {
            // Robust key lookup: case-insensitive, collapse spaces, allow space-less variants
            const rowKeys = Object.keys(row || {});
            const normalizeKey = k => String(k || '').toLowerCase().trim().replace(/\s+/g, ' ');
            const normalizeKeyLoose = k => String(k || '').toLowerCase().replace(/\s+/g, '');
            const findByKey = candidate => {
                const norm = normalizeKey(candidate);
                const loose = normalizeKeyLoose(candidate);
                // exact normalized match
                for (const key of rowKeys) {
                    if (normalizeKey(key) === norm) return row[key];
                }
                // loose match (spaces removed)
                for (const key of rowKeys) {
                    if (normalizeKeyLoose(key) === loose) return row[key];
                }
                return undefined;
            };
            const pick = (obj, keys) => {
                for (let k of keys) {
                    const v = findByKey(k);
                    if (v !== undefined && v !== null && String(v).trim() !== '') return v;
                }
                return '';
            };
            const statusRaw = String(pick(row, ['status'])).trim().toUpperCase();
            let statusNormalized = 'unknown';
            if (statusRaw === 'A') statusNormalized = 'active';
            else if (statusRaw === 'P') statusNormalized = 'passive';
            else if (statusRaw === 'T') statusNormalized = 'to-be-consumed';
            else if (statusRaw === 'H') statusNormalized = 'special-product';

            const catalogId = String(pick(row, ['katalog id'])).trim();
            const shortCode = String(pick(row, ['√ºr√ºn kƒ±sa kodu'])).trim();

            return {
                product_code: catalogId || shortCode,
                description_tr: String(pick(row, ['varyans-tr'])).trim(),
                description_en: String(pick(row, ['varyans-en'])).trim(),
                main_tr: String(pick(row, ['ana √ºr√ºn-tr'])).trim(),
                main_en: String(pick(row, ['ana √ºr√ºn - en', 'ana √ºr√ºn-en'])).trim(),
                moq: String(pick(row, ['moq'])).trim() || '0',
                packing_qty: String(pick(row, ['paket adedi'])).trim() || '1',
                status: statusNormalized,
                status_raw: statusRaw,
                category: String(pick(row, ['kategori'])).trim(),
                colors: '',
                canias_code: String(pick(row, ['canias kod'])).trim(),
                short_code: shortCode,
                catalog_id: catalogId || shortCode,
                page_number: String(pick(row, ['katalog sayfa numarasƒ±'])).trim() || '0'
            };
        }

        // Language helpers
        function getLocalizedDescription(product) {
            if (currentLanguage === 'en') {
                return product.description_en || product.description_tr || '';
            }
            return product.description_tr || product.description_en || '';
        }

        // Translate status values
        function getLocalizedStatus(status) {
            const statusTranslations = {
                'active': currentLanguage === 'tr' ? 'Aktif' : 'Active',
                'passive': currentLanguage === 'tr' ? 'Kontrol' : 'Control',
                'to-be-consumed': currentLanguage === 'tr' ? 'Kontrol' : 'Control',
                'unknown': currentLanguage === 'tr' ? 'Kontrol' : 'Control',
                'inactive': currentLanguage === 'tr' ? 'Pasif' : 'Inactive',
                'special-product': currentLanguage === 'tr' ? '√ñzel √úr√ºn' : 'Unavailable Product'
            };
            return statusTranslations[status.toLowerCase()] || status;
        }
        function getLocalizedMainName(product) {
            if (currentLanguage === 'en') {
                return product.main_en || product.main_tr || '';
            }
            return product.main_tr || product.main_en || '';
        }
        
        // Show/hide loading overlay
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Show messages
        function showMessage(message, type) {
            // Use new notification system for better UX
            const title = type === 'error' ? 'Error' : 'Success';
            showNotification(title, message, type, 4000);
            
            // Also keep the old system for backward compatibility
            const messageEl = type === 'error' ? 
                document.getElementById('errorMessage') : 
                document.getElementById('successMessage');
            
            if (messageEl) {
                messageEl.textContent = message;
                messageEl.style.display = 'block';
                
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 3000);
            }
        }
        
        // Populate filter dropdowns
        function populateFilters() {
            // Only color for now; categories handled separately
            const colorSet = new Set();
            products.forEach(p => {
                if (p.colors) {
                    p.colors.split(';').forEach(c => colorSet.add(c.trim()));
                }
            });
            const colors = Array.from(colorSet).filter(Boolean);
            // color filter removed
        }

        function populateCategoryFilters() {
            console.log('Populating category filters...');
            console.log('CategoriesMain length:', categoriesMain.length);
            console.log('CategoriesSub length:', categoriesSub.length);
            
            const mainSel = document.getElementById('mainCategoryFilter');
            const subSel = document.getElementById('subCategoryFilter');
            if (!mainSel || !subSel) {
                console.error('Category filter elements not found!');
                return;
            }
            
            mainSel.innerHTML = '<option value="">' + t('allMainCats') + '</option>';
            categoriesMain.forEach(c => {
                const label = currentLanguage === 'en' ? (c.en || c.tr || c.code) : (c.tr || c.en || c.code);
                mainSel.innerHTML += `<option value="${c.code}">${c.code} - ${label}</option>`;
            });
            // Reset sub
            subSel.innerHTML = '<option value="">' + t('allSubCats') + '</option>';
            subSel.disabled = true;
            
            console.log('Category filters populated successfully');
        }

        function onMainCategoryChange() {
            const mainSel = document.getElementById('mainCategoryFilter');
            const subSel = document.getElementById('subCategoryFilter');
            const mainCode = mainSel.value;
            if (!mainCode) {
                subSel.innerHTML = '<option value="">' + t('allSubCats') + '</option>';
                subSel.disabled = true;
                filterProducts();
                return;
            }
            const subs = categoriesSub.filter(s => s.parent === mainCode);
            subSel.innerHTML = '<option value="">' + t('allSubCats') + '</option>';
            subs.forEach(s => {
                const label = currentLanguage === 'en' ? (s.en || s.tr || s.code) : (s.tr || s.en || s.code);
                subSel.innerHTML += `<option value="${s.code}">${s.code} - ${label}</option>`;
            });
            subSel.disabled = false;
            filterProducts();
        }
        
        // Display products in table
        function displayProducts(filteredProducts = products) {
            const tbody = document.getElementById('productTableBody');
            tbody.innerHTML = '';
            
            // Check if user has applied any filters
            const searchTerm = document.getElementById('searchInput').value.trim();
            const mainCategory = document.getElementById('mainCategoryFilter').value;
            const subCategory = document.getElementById('subCategoryFilter').value;
            const noMoqFilter = document.getElementById('noMoqFilter').checked;
            const color = '';
            const hasFilters = searchTerm || mainCategory || subCategory || document.getElementById('catalogPageInput').value || noMoqFilter;
            
            // If no filters applied, show message to start searching
            const catalogPage = document.getElementById('catalogPageInput').value;
            if (!hasFilters && !catalogPage) {
                document.getElementById('productCount').textContent = t('enterSearchToView');
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; color: #666; font-style: italic;">${t('enterSearchToView')}</td></tr>`;
                
                // Hide only the bottom pagination controls
                document.querySelector('.pagination-controls-bottom').style.display = 'none';
                // Do NOT hide the top controls
                return;
            }
            
            // Show only the bottom pagination controls when filters are applied
            document.querySelector('.pagination-controls-bottom').style.display = 'block';
            
            // Store filtered products for pagination
            window.filteredProducts = filteredProducts;
            
            // Sort products alphabetically by product code (all statuses shown)
            const sortedProducts = [...filteredProducts].sort((a, b) => {
                const codeA = (a.product_code || '').toLowerCase();
                const codeB = (b.product_code || '').toLowerCase();
                return codeA.localeCompare(codeB);
            });
            
            // Calculate pagination
            const totalPages = Math.ceil(sortedProducts.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const currentPageProducts = sortedProducts.slice(startIndex, endIndex);
            
            // Update product count
            const showingText = (currentLanguage === 'en')
                ? `Showing ${startIndex + 1}-${Math.min(endIndex, sortedProducts.length)} of ${sortedProducts.length} products (Page ${currentPage} of ${totalPages})`
                : `${sortedProducts.length} √ºr√ºnden ${startIndex + 1}-${Math.min(endIndex, sortedProducts.length)} arasƒ± g√∂steriliyor (Sayfa ${currentPage}/${totalPages})`;
            document.getElementById('productCount').textContent = showingText;
            
            // Update pagination controls
            updatePaginationControls(totalPages);
            
            if (currentPageProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No products found matching your criteria</td></tr>';
                return;
            }
            
            currentPageProducts.forEach((product, index) => {
                const colors = product.colors ? product.colors.split(';') : ['Default'];
                const statusClass = getStatusClass(product.status);
                const productIndex = allProducts.findIndex(p => p.product_code === product.product_code);
                const isPopular = isPopularProduct(product);
                
                // If product not found in allProducts, use the current index from filteredProducts
                const actualIndex = productIndex !== -1 ? productIndex : index;
                
                // Handle MOQ of 0 (no minimum)
                const moq = parseInt(product.moq) || 1;
                const packingQty = parseInt(product.packing_qty) || 1;
                
                // Status tooltip content
                const statusExplanations = {
                    'active': currentLanguage === 'tr' 
                        ? '≈ûu anda √ºretim i√ßin mevcut olan √ºr√ºnler. Bu √ºr√ºnler d√ºzenli √ºretimde olup standart teslimat s√ºreleri ile sipari≈ü verilebilir.'
                        : 'Products that are currently available for production. These items are in regular production and can be ordered with standard lead times.',
                    'passive': currentLanguage === 'tr'
                        ? 'Sepetinize ekleyebilirsiniz, inceleyip buna g√∂re teklif vereceƒüiz.'
                        : 'You can add it to your basket, we will review and quote accordingly.',
                    'to-be-consumed': currentLanguage === 'tr'
                        ? 'Sepetinize ekleyebilirsiniz, inceleyip buna g√∂re teklif vereceƒüiz.'
                        : 'You can add it to your basket, we will review and quote accordingly.',
                    'unknown': currentLanguage === 'tr'
                        ? 'Sepetinize ekleyebilirsiniz, inceleyip buna g√∂re teklif vereceƒüiz.'
                        : 'You can add it to your basket, we will review and quote accordingly.',
                    'inactive': currentLanguage === 'tr'
                        ? 'Artƒ±k mevcut olmayan veya kalƒ±p bakƒ±m gerektiren √ºr√ºnler. Bu √ºr√ºnler ≈üu anda √ºretilemez.'
                        : 'Products that are no longer available or the mould requires maintenance. These items cannot be produced at the moment.',
                    'special-product': currentLanguage === 'tr'
                        ? 'HL Display √ºr√ºnlerinde √ßok fazla opsiyon olduƒüu i√ßin l√ºtfen talebinizi iletirken notlar kƒ±smƒ±nda ihtiyacƒ±nƒ±z olan √ºr√ºn√º detaylƒ± olarak belirtiniz.'
                        : 'Unavailable Product'
                };
                const statusKey = product.status.toLowerCase();
                let statusLabel = (function() {
                    if (product.status === 'active') return currentLanguage === 'tr' ? 'Aktif' : 'Active';
                    if (product.status === 'passive') return currentLanguage === 'tr' ? 'Kontrol' : 'Control';
                    if (product.status === 'to-be-consumed') return currentLanguage === 'tr' ? 'Kontrol' : 'Control';
                    if (product.status === 'unknown') return currentLanguage === 'tr' ? 'Kontrol' : 'Control';
                    if (product.status === 'special-product') return currentLanguage === 'tr' ? '√ñzel √úr√ºn' : 'Unavailable Product';
                    return product.status;
                })();
                let statusTooltip = statusExplanations[statusKey] || '';
                let statusCell = `<span>${statusLabel}</span><span class=\"status-tooltip-icon\" tabindex=\"0\"> ‚ÑπÔ∏è<span class=\"status-tooltip-popup\">${statusTooltip}</span></span>`;
                if (isPopular) {
                    statusCell = `<span>${statusLabel}<span class='status-bestseller'>- Bestseller <span style='font-size:1.1em;'>‚≠ê</span></span></span><span class=\"status-tooltip-icon\" tabindex=\"0\"> ‚ÑπÔ∏è<span class=\"status-tooltip-popup\">${statusTooltip}<br><br><span style='color:#ffb300;font-weight:bold;'>Bestseller:</span> High demand, fast production, proven quality and reliability.</span></span>`;
                }
                
                const row = `
                    <tr>
                        <td style="text-align: center; font-weight: bold; font-size: 1.1em;">
                            ${product.canias_code || product.product_code}
                        </td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <img src="${getProductImage(product)}" 
                                     alt="${getLocalizedDescription(product)}" 
                                     style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;"
                                     onerror="this.src='https://www.dogukanlevent.com/RFQ-Web/PHLogo.png'">
                                <span title="${getLocalizedMainName(product)}${product.short_code ? ' | ' + product.short_code : ''}">${getLocalizedDescription(product)}</span>
                            </div>
                        </td>
                        <td class="${statusClass}" style="text-align: center;">${statusCell}</td>
                        <td style="text-align: center; line-height: 1.2;">
                            <div style="font-size: 0.85em; font-weight: bold; color: #333;">${packingQty}</div>
                        </td>
                        <td style="text-align: center;">
                            ${moq > 1 ? `<div style="font-size: 0.75em; color: #666; margin-bottom: 4px;">MOQ: ${moq}</div>` : ''}
                            <input type="number" 
                                   class="quantity-input" 
                                   id="qty-${actualIndex}" 
                                   min="${moq}" 
                                   step="${packingQty}"
                                   placeholder="0">
                        </td>
                        <td>
                            <button class="btn btn-add" onclick="addToOrderFromDisplay('${product.product_code}')">${t('add')}</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // Turkish case conversion helper
        function toTurkishLowerCase(str) {
            if (!str) return '';
            return str
                .replace(/ƒ∞/g, 'i')
                .replace(/I/g, 'ƒ±')
                .replace(/ƒû/g, 'ƒü')
                .replace(/√ú/g, '√º')
                .replace(/≈û/g, '≈ü')
                .replace(/√ñ/g, '√∂')
                .replace(/√á/g, '√ß')
                .toLowerCase();
        }

        // Filter products
        function filterProducts() {
            const searchTerm = toTurkishLowerCase(document.getElementById('searchInput').value.trim());
            const mainCategory = document.getElementById('mainCategoryFilter').value;
            const subCategory = document.getElementById('subCategoryFilter').value;
            const catalogPage = document.getElementById('catalogPageInput').value;
            const noMoqFilter = document.getElementById('noMoqFilter').checked;
            const color = '';

            // Check if any filters are applied
            const hasFilters = searchTerm || mainCategory || subCategory || catalogPage || noMoqFilter;

            if (!hasFilters) {
                // No filters applied, show initial state
                currentPage = 1;
                displayProducts();
                return;
            }

            const filtered = allProducts.filter(product => {
                // Search in multiple fields: Varyans-TR, Varyans-EN, Ana √úr√ºn-TR, Ana √úr√ºn - EN, √úr√ºn Kƒ±sa Kodu, Product Code
                const varyansTR = toTurkishLowerCase(product.description_tr || '');
                const varyansEN = toTurkishLowerCase(product.description_en || '');
                const anaUrunTR = toTurkishLowerCase(product.main_tr || '');
                const anaUrunEN = toTurkishLowerCase(product.main_en || '');
                const urunKisaKodu = toTurkishLowerCase(product.short_code || '');
                const productCode = toTurkishLowerCase(product.product_code || '');
                
                // Multi-word, order-insensitive search
                const searchWords = searchTerm.split(/\s+/).filter(Boolean);
                const matchSearch = searchWords.every(word =>
                    varyansTR.includes(word) || 
                    varyansEN.includes(word) || 
                    anaUrunTR.includes(word) || 
                    anaUrunEN.includes(word) || 
                    urunKisaKodu.includes(word) ||
                    productCode.includes(word)
                );
                // Category matching
                let matchCategory = true;
                if (mainCategory) {
                    matchCategory = (product.category || '').startsWith(mainCategory);
                }
                if (matchCategory && subCategory) {
                    matchCategory = (product.category || '') === subCategory;
                }
                // Page number matching
                let matchPage = true;
                if (catalogPage) {
                    const productPage = (product.page_number || '0').toString();
                    matchPage = productPage === catalogPage;
                }
                
                // MOQ filter matching
                let matchMoq = true;
                if (noMoqFilter) {
                    const moq = parseInt(product.moq) || 0;
                    matchMoq = moq === 0;
                }
                
                let matchColor = true; // color filter removed
                // Show all products regardless of status (Active, Passive, To-be-consumed)
                return matchSearch && matchCategory && matchColor && matchPage && matchMoq;
            });

            // Reset to first page when filtering
            currentPage = 1;
            displayProducts(filtered);
        }
        
        // Get status class for styling
        function getStatusClass(status) {
            const statusLower = status.toLowerCase();
            if (statusLower === 'active') {
                return 'status-active';
            } else if (statusLower === 'passive' || statusLower === 'to-be-consumed' || statusLower === 'unknown') {
                return 'status-control';
            } else if (statusLower === 'inactive') {
                return 'status-inactive';
            } else if (statusLower === 'special-product') {
                return 'status-special-product';
            } else {
                return 'status-unknown';
            }
        }

        function setLanguage(lang) {
            currentLanguage = (lang === 'en') ? 'en' : 'tr';
            // Refresh displayed products with current filters
            applyI18nTexts();
            populateCategoryFilters();
            filterProducts();
            updateLangButtons();
        }

        // Welcome section functions
        function startShopping() {
            // Close welcome modal (same as clicking close button)
            closeWelcomeModal();
            
            // Mark as not first visit
            isFirstVisit = false;
            localStorage.setItem('rfq_first_visit', 'false');
        }

        function showHelp() {
            // Create help modal
            const helpModal = document.createElement('div');
            helpModal.className = 'help-modal';
            helpModal.innerHTML = `
                <div class="help-modal-content">
                    <div class="help-modal-header">
                        <h3 id="helpTitle">How to Use This System</h3>
                        <button class="help-close" onclick="closeHelp()">&times;</button>
                    </div>
                    <div class="help-modal-body">
                        <div class="help-section">
                            <h4 id="helpStep1">Step 1: Find Products</h4>
                            <p id="helpStep1Desc">Use the search box to find products by name or code. You can also filter by category to narrow down your search.</p>
                        </div>
                        <div class="help-section">
                            <h4 id="helpStep2">Step 2: Add to Cart</h4>
                            <p id="helpStep2Desc">Click on any product to add it to your quote request. You can specify quantities and see your cart in the floating basket button.</p>
                        </div>
                        <div class="help-section">
                            <h4 id="helpStep3">Step 3: Submit Request</h4>
                            <p id="helpStep3Desc">When you're ready, click the basket button and fill in your contact details to send us your quote request.</p>
                        </div>
                        <div class="help-tips">
                            <h4 id="helpTips">üí° Tips:</h4>
                            <ul>
                                <li id="helpTip1">You can request alternatives if a product is not available</li>
                                <li id="helpTip2">All fields marked with * are required</li>
                                <li id="helpTip3">You can change language using the flag buttons</li>
                            </ul>
                        </div>
                    </div>
                    <div class="help-modal-footer">
                        <button class="btn btn-primary" onclick="closeHelp(); startShopping();" id="helpStartBtn">Start Shopping</button>
                        <button class="btn btn-secondary" onclick="closeHelp()" id="helpCloseBtn">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(helpModal);
            applyI18nTexts(); // Apply translations
        }

        function closeHelp() {
            const helpModal = document.querySelector('.help-modal');
            if (helpModal) {
                helpModal.remove();
            }
        }

        // Function to reset welcome screen settings (for testing/admin use)
        function resetWelcomeScreen() {
            localStorage.removeItem('rfq_first_visit');
            localStorage.removeItem('rfq_selected_language');
            showNotification(
                currentLanguage === 'en' ? 'Settings Reset' : 'Ayarlar Sƒ±fƒ±rlandƒ±',
                currentLanguage === 'en' ? 
                    'All settings have been reset. Refresh the page to see the language selection screen again.' :
                    'T√ºm ayarlar sƒ±fƒ±rlandƒ±. Sayfayƒ± yenileyerek dil se√ßim ekranƒ±nƒ± tekrar g√∂rebilirsiniz.',
                'success',
                5000
            );
        }

        // Function to handle language selection
        function selectLanguage(lang) {
            // Set the selected language
            setLanguage(lang);
            
            // Store language preference
            localStorage.setItem('rfq_selected_language', lang);
            
            // Hide language selection screen
            const languageSelection = document.getElementById('languageSelection');
            if (languageSelection) {
                languageSelection.style.display = 'none';
            }
            
            // Hide main content to ensure clean transition
            const mainContent = document.querySelector('.main-content-area');
            if (mainContent) {
                mainContent.style.display = 'none';
            }
            
            // Hide header
            const header = document.querySelector('.rfq-header');
            if (header) {
                header.style.display = 'none';
            }
            
            // Show welcome section
            const welcomeSection = document.getElementById('welcomeSection');
            if (welcomeSection) {
                welcomeSection.style.display = 'block';
            }
        }

        // Function to show welcome screen from help button
        function showWelcomeScreen() {
            // Hide main content
            const mainContent = document.querySelector('.main-content-area');
            if (mainContent) {
                mainContent.style.display = 'none';
            }
            
            // Hide language selection screen
            const languageSelection = document.getElementById('languageSelection');
            if (languageSelection) {
                languageSelection.style.display = 'none';
            }
            
            // Show welcome section
            const welcomeSection = document.getElementById('welcomeSection');
            if (welcomeSection) {
                welcomeSection.style.display = 'block';
            }
        }

        // Function to close welcome modal
        function closeWelcomeModal(event) {
            if (event && event.target !== event.currentTarget) {
                return; // Don't close if clicking inside the modal content
            }
            
            // Hide welcome section
            const welcomeSection = document.getElementById('welcomeSection');
            if (welcomeSection) {
                welcomeSection.style.display = 'none';
            }
            
            // Show header
            const header = document.querySelector('.rfq-header');
            if (header) {
                header.style.display = 'flex';
            }
            
            // Show main content
            const mainContent = document.querySelector('.main-content-area');
            if (mainContent) {
                mainContent.style.display = 'block';
            }
        }
        
        // Function to toggle "Don't show again" setting
        function toggleDontShowWelcome() {
            const checkbox = document.getElementById('dontShowWelcome');
            if (checkbox.checked) {
                localStorage.setItem('rfq_dont_show_welcome', 'true');
                console.log('Welcome screen will be skipped in future visits');
            } else {
                localStorage.removeItem('rfq_dont_show_welcome');
                console.log('Welcome screen will be shown in future visits');
            }
        }
        
        // Function to open digital catalog based on current language
        function openDigitalCatalog() {
            // Define catalog URLs for each language
            const catalogUrls = {
                'tr': 'https://dogukanlevent.com/RFQ-Web/TR.html', // Turkish catalog page
                'en': 'https://dogukanlevent.com/RFQ-Web/EN.html'   // English catalog page
            };
            
            const currentLang = currentLanguage || 'en';
            const catalogUrl = catalogUrls[currentLang];
            
            if (catalogUrl) {
                // Open catalog in new tab
                window.open(catalogUrl, '_blank');
                console.log('Opening catalog for language:', currentLang, 'URL:', catalogUrl);
            } else {
                console.error('No catalog URL found for language:', currentLang);
                showNotification('Error', 'Catalog not available for current language', 'error');
            }
        }

        // Function to show language selection screen
        function showLanguageSelection() {
            // Hide all other sections
            const mainContent = document.querySelector('.main-content-area');
            const welcomeSection = document.getElementById('welcomeSection');
            
            if (mainContent) {
                mainContent.style.display = 'none';
            }
            if (welcomeSection) {
                welcomeSection.style.display = 'none';
            }
            
            // Show language selection
            const languageSelection = document.getElementById('languageSelection');
            if (languageSelection) {
                languageSelection.style.display = 'block';
            }
        }

        // Notification system
        function showNotification(title, message, type = 'success', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">${title}</div>
                    <button class="notification-close" onclick="closeNotification(this)">&times;</button>
                </div>
                <div class="notification-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-hide after duration
            if (duration > 0) {
                setTimeout(() => {
                    closeNotification(notification.querySelector('.notification-close'));
                }, duration);
            }
        }

        function closeNotification(closeBtn) {
            const notification = closeBtn.closest('.notification');
            if (notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }
        }

        function t(key) {
            const dict = {
                en: {
                    language: 'Language',
                    langHint: '(you can change the language)',
                    searchPlaceholder: 'Search by code or description...',
                    allMainCats: 'All Main Categories',
                    allSubCats: 'All Sub Categories',
                    allColors: 'All Colors',
                    searchTitle: 'SEARCH',
                    add: 'Add',
                    addToBasket: 'Add to Request',
                    enterSearchToView: 'Please enter a search term or select a category to view products',
                    headerTitle: "HMK RFQ Portal",
                    welcomeTitle: "Welcome",
                    welcomeSubtitle: "Create your quote request in just 3 simple steps",
                    step1Title: "Browse Products",
                    step1Desc: "Search and filter our product catalog to find what you need",
                    step2Title: "Add to Cart",
                    step2Desc: "Select quantities and add products to your quote request",
                    step3Title: "Submit Request",
                    step3Desc: "Fill in your details and send us your quote request",
                    startBtnText: "Start Shopping",
                    helpBtnText: "Need Help?",
                    helpTitle: "How to Use This System",
                    helpStep1: "Step 1: Find Products",
                    helpStep1Desc: "Use the search box to find products by name or code. You can also filter by category to narrow down your search.",
                    helpStep2: "Step 2: Add to Cart",
                    helpStep2Desc: "Click on any product to add it to your quote request. You can specify quantities and see your cart in the floating basket button.",
                    helpStep3: "Step 3: Submit Request",
                    helpStep3Desc: "When you're ready, click the basket button and fill in your contact details to send us your quote request.",
                    helpTips: "üí° Tips:",
                    helpTip1: "You can request alternatives if a product is not available",
                    helpTip2: "All fields marked with * are required",
                    helpTip3: "You can change language using the flag buttons",
                    helpStartBtn: "Start Shopping",
                    helpCloseBtn: "Close",
                    helpButtonTitle: "Help & Guide",
                    helpButtonText: "Help",
                    dontShowText: "Don't show this again",
                    catalogBtnText: "View Digital Catalog",
                    languageSelectionTitle: "Choose Your Language",
                    languageSelectionSubtitle: "Please select your preferred language to continue",
                    basket: 'Request List',
                    orderBasket: 'Request List',
                    totalItems: 'Total Items:',
                    proceed: 'Proceed to Request',
                    clearAll: 'Clear All',
                    thCode: 'Product Code',
                    thDesc: 'Description',
                    thStatus: 'Status',
                    thPackQty: 'Pack Qty',
                    thAction: 'Action', thQuantity: 'Quantity',
                    ppp: 'Products per page: ',
                    catalogPagePlaceholder: 'Catalog page number...',
                    noMoqText: 'List Products Without MOQ',
                    orderSummary: 'Request Summary',
                    backToBasket: 'Back to Request',
                    continueToCustomer: 'Continue to Customer Info',
                    customerInfoTitle: 'Customer Information & Request Finalization',
                    labelOrderNumber: 'Request Number (If applicable)',
                    labelCompanyName: 'Company Name *',
                    labelContactPerson: 'Contact Person *',
                    labelEmail: 'Email *',
                    labelPhone: 'Phone',
                    labelAdditionalNotes: 'Additional Notes',
                    backToSummary: 'Back to Summary',
                    submitOrder: 'Send Request', totalProducts: 'Total Products:', totalQuantity: 'Total Quantity:',
                    packLabel: 'Pack',
                    qtyLabel: 'Qty',
                    quantityLabel: 'Quantity:',
                    enterQuantity: 'Enter quantity',
                    statusLabel: 'Status:',
                    remove: 'Remove',
                    moqExceptionTitle: 'MOQ Exception Request',
                    moqExceptionInfo: 'This product has a Minimum Order Quantity (MOQ) of',
                    moqExceptionRequested: '',
                    moqExceptionNote: 'adet.',
                    moqExceptionChoose: 'Please choose an option below:',
                    moqOptionStockTitle: 'Add available stock quantity to quote.',
                    moqOptionStockDesc: '',
                    moqOptionMOQTitle: 'Increase to MOQ quantity',
                    moqOptionMOQDesc: '',
                    moqCancel: 'Cancel',
                    moqProceed: 'Proceed',
                    stockCheckRequested: 'Stock check requested',
                    recaptchaTitle: 'Security Verification',
                    recaptchaDesc: 'Please complete the security verification to send your request.',
                    recaptchaCancel: 'Cancel',
                    recaptchaVerify: 'Verify & Send Request',
                    confirmationTitle: 'Request Received!',
                    confirmationMessage: 'Thank you for your request. We have received your inquiry and will respond to you via email shortly.',
                    confirmationOrderNumberLabel: 'Request Number:',
                    confirmationDateLabel: 'Date:',
                    confirmationEmailLabel: 'Email:',
                    confirmationNewOrder: 'Start New Request',
                    confirmationHome: 'Back to Products',
                    quantityMultiplesError: 'Quantity must be in multiples of',
                    quantityRequiredError: 'Please enter a quantity',
                    quantityValidError: 'Please enter a valid quantity',
                    moqIncreasedMessage: 'Increased to MOQ',
                    moqStockMessage: 'Will quote available stock if less than MOQ'
                },
                tr: {
                    language: 'Dil',
                    langHint: '(dili burada deƒüi≈ütirebilirsiniz)',
                    searchPlaceholder: 'Koda veya a√ßƒ±klamaya g√∂re ara...',
                    allMainCats: 'T√ºm Ana Kategoriler',
                    allSubCats: 'T√ºm Alt Kategoriler',
                    allColors: 'T√ºm Renkler',
                    searchTitle: 'ARAMA',
                    add: 'Ekle',
                    addToBasket: 'Talep Listesine Ekle',
                    enterSearchToView: '√úr√ºnleri g√∂rmek i√ßin arama terimi girin veya kategori se√ßin',
                    headerTitle: 'HMK Fiyat Talep Portalƒ±',
                    welcomeTitle: "Ho≈ü Geldiniz",
                    welcomeSubtitle: "Sadece 3 basit adƒ±mda teklif talebinizi olu≈üturun",
                    step1Title: "√úr√ºnleri Ke≈üfedin",
                    step1Desc: "ƒ∞htiyacƒ±nƒ±z olan √ºr√ºnleri bulmak i√ßin √ºr√ºn kataloƒüumuzda arama yapƒ±n ve filtreleyin",
                    step2Title: "Sepete Ekleyin",
                    step2Desc: "Miktarlarƒ± belirleyin ve √ºr√ºnleri teklif talebinize ekleyin",
                    step3Title: "Talebi G√∂nderin",
                    step3Desc: "Bilgilerinizi doldurun ve teklif talebinizi bize g√∂nderin",
                    startBtnText: "Alƒ±≈üveri≈üe Ba≈üla",
                    helpBtnText: "Yardƒ±ma mƒ± ƒ∞htiyacƒ±nƒ±z Var?",
                    helpTitle: "Bu Sistemi Nasƒ±l Kullanƒ±lƒ±r",
                    helpStep1: "Adƒ±m 1: √úr√ºnleri Bulun",
                    helpStep1Desc: "√úr√ºn adƒ± veya kodu ile arama yapmak i√ßin arama kutusunu kullanƒ±n. Arama alanƒ±nƒ± daraltmak i√ßin kategoriye g√∂re de filtreleyebilirsiniz.",
                    helpStep2: "Adƒ±m 2: Sepete Ekleyin",
                    helpStep2Desc: "Teklif talebinize eklemek i√ßin herhangi bir √ºr√ºne tƒ±klayƒ±n. Miktarlarƒ± belirleyebilir ve sepetinizi y√ºzen sepet d√ºƒümesinde g√∂rebilirsiniz.",
                    helpStep3: "Adƒ±m 3: Talebi G√∂nderin",
                    helpStep3Desc: "Hazƒ±r olduƒüunuzda, sepet d√ºƒümesine tƒ±klayƒ±n ve teklif talebinizi bize g√∂ndermek i√ßin ileti≈üim bilgilerinizi doldurun.",
                    helpTips: "üí° ƒ∞pu√ßlarƒ±:",
                    helpTip1: "Bir √ºr√ºn mevcut deƒüilse alternatif talep edebilirsiniz",
                    helpTip2: "* ile i≈üaretlenen t√ºm alanlar zorunludur",
                    helpTip3: "Bayrak d√ºƒümelerini kullanarak dili deƒüi≈ütirebilirsiniz",
                    helpStartBtn: "Alƒ±≈üveri≈üe Ba≈üla",
                    helpCloseBtn: "Kapat",
                    helpButtonTitle: "Yardƒ±m ve Rehber",
                    helpButtonText: "Yardƒ±m",
                    dontShowText: "Bunu bir daha g√∂sterme",
                    catalogBtnText: "Dijital Katalogu G√∂r√ºnt√ºle",
                    languageSelectionTitle: "Dilinizi Se√ßin",
                    languageSelectionSubtitle: "Devam etmek i√ßin tercih ettiƒüiniz dili se√ßin",
                    basket: 'Talep Listesi',
                    orderBasket: 'Talep Listesi',
                    totalItems: 'Toplam √úr√ºn:',
                    proceed: 'Talep Adƒ±mƒ±na Ge√ß',
                    clearAll: 'T√ºm√ºn√º Temizle',
                    thCode: '√úr√ºn Kodu',
                    thDesc: 'A√ßƒ±klama',
                    thStatus: 'Durum',
                    thPackQty: 'Paket Adedi',
                    thAction: 'ƒ∞≈ülem', thQuantity: 'Adet',
                    ppp: 'Sayfa ba≈üƒ±na √ºr√ºn: ',
                    catalogPagePlaceholder: 'Katalog sayfa numarasƒ±...',
                    noMoqText: 'MOQ Olmayan √úr√ºnleri Listele',
                    orderSummary: 'Talep √ñzeti',
                    backToBasket: 'Talep Listesine D√∂n',
                    continueToCustomer: 'M√º≈üteri Bilgilerine Ge√ß',
                    customerInfoTitle: 'M√º≈üteri Bilgileri ve Talep Onayƒ±',
                    labelOrderNumber: 'Talep Numarasƒ± (Varsa)',
                    labelCompanyName: 'Firma Adƒ± *',
                    labelContactPerson: 'Yetkili Ki≈üi *',
                    labelEmail: 'E-posta *',
                    labelPhone: 'Telefon',
                    labelAdditionalNotes: 'Ek Notlar',
                    backToSummary: '√ñzete D√∂n',
                    submitOrder: 'Talebi G√∂nder', totalProducts: 'Toplam √úr√ºn:', totalQuantity: 'Toplam Adet:',
                    packLabel: 'Paket Adedi',
                    qtyLabel: 'Adet',
                    quantityLabel: 'Adet:',
                    enterQuantity: 'Adet girin',
                    statusLabel: 'Durum:',
                    remove: 'Kaldƒ±r',
                    moqExceptionTitle: 'MOQ ƒ∞stisna Talebi',
                    moqExceptionInfo: '√úr√ºn√ºn Minimum Sipari≈ü Miktarƒ±',
                    moqExceptionRequested: '',
                    moqExceptionNote: 'Adettir.',
                    moqExceptionChoose: 'L√ºtfen a≈üaƒüƒ±daki se√ßeneklerden birini se√ßin:',
                    moqOptionStockTitle: 'Stokta mevcut olan miktarƒ± teklife ekleyin.',
                    moqOptionStockDesc: '',
                    moqOptionMOQTitle: 'MOQ adedine y√ºkselt',
                    moqOptionMOQDesc: '',
                    moqCancel: 'ƒ∞ptal',
                    moqProceed: 'Devam Et',
                    stockCheckRequested: 'Stok kontrol√º talep edildi',
                    recaptchaTitle: 'G√ºvenlik Doƒürulamasƒ±',
                    recaptchaDesc: 'Talebinizi g√∂ndermek i√ßin l√ºtfen g√ºvenlik doƒürulamasƒ±nƒ± tamamlayƒ±n.',
                    recaptchaCancel: 'ƒ∞ptal',
                    recaptchaVerify: 'Doƒürula ve Talebi G√∂nder',
                    confirmationTitle: 'Talep Alƒ±ndƒ±!',
                    confirmationMessage: 'Talebiniz i√ßin te≈üekk√ºr ederiz. Talebinizi aldƒ±k ve kƒ±sa s√ºre i√ßinde e-posta ile size yanƒ±t vereceƒüiz.',
                    confirmationOrderNumberLabel: 'Talep Numarasƒ±:',
                    confirmationDateLabel: 'Tarih:',
                    confirmationEmailLabel: 'E-posta:',
                    confirmationNewOrder: 'Yeni Talep Ba≈ülat',
                    confirmationHome: '√úr√ºnlere D√∂n',
                    quantityMultiplesError: 'Paket Adedi,',
                    quantityRequiredError: 'L√ºtfen adet girin',
                    quantityValidError: 'L√ºtfen ge√ßerli bir adet girin',
                    moqIncreasedMessage: 'MOQ\'a Y√ºkseltildi',
                    moqStockMessage: 'MOQ\'dan az ise mevcut stok fiyatlandƒ±rƒ±lacak'
                }
            };
            const lang = currentLanguage === 'en' ? 'en' : 'tr';
            return (dict[lang] && dict[lang][key]) || key;
        }

        function applyI18nTexts() {
            const langLabel = document.getElementById('langLabel');
            const langHint = document.getElementById('langHint');
            const searchInput = document.getElementById('searchInput');
            const catalogPageInput = document.getElementById('catalogPageInput');
            const mainSel = document.getElementById('mainCategoryFilter');
            const subSel = document.getElementById('subCategoryFilter');
            const colorSel = null;
            const searchTitle = document.querySelector('.search-area-title');
            const noMoqText = document.getElementById('noMoqText');
            if (langLabel) langLabel.textContent = t('language');
            if (langHint) langHint.textContent = t('langHint');
            if (searchInput) searchInput.placeholder = t('searchPlaceholder');
            if (catalogPageInput) catalogPageInput.placeholder = t('catalogPagePlaceholder');
            if (searchTitle) searchTitle.textContent = t('searchTitle');
            if (mainSel) mainSel.options[0].textContent = t('allMainCats');
            if (subSel) subSel.options[0].textContent = t('allSubCats');
            if (colorSel) colorSel.options[0].textContent = t('allColors');
            if (noMoqText) noMoqText.textContent = t('noMoqText');
            const headerTitle = document.getElementById('headerTitle');
            if (headerTitle) headerTitle.textContent = t('headerTitle');
            const cartBtnText = document.getElementById('cartBtnText');
            if (cartBtnText) cartBtnText.textContent = t('basket');
            const cartPanelTitle = document.getElementById('cartPanelTitle');
            if (cartPanelTitle) cartPanelTitle.textContent = t('orderBasket');
            const basketTitle = document.getElementById('basketTitle');
            if (basketTitle) basketTitle.textContent = t('orderBasket');
            const basketTotalLabel = document.getElementById('basketTotalLabel');
            if (basketTotalLabel) basketTotalLabel.textContent = t('totalItems');
            const proceedBtn = document.getElementById('proceedBtn');
            if (proceedBtn) proceedBtn.textContent = t('proceed');
            const clearAllBtn = document.getElementById('clearAllBtn');
            if (clearAllBtn) clearAllBtn.textContent = t('clearAll');
            const thCode = document.getElementById('thCode');
            if (thCode) thCode.textContent = t('thCode');
            const thDesc = document.getElementById('thDesc');
            if (thDesc) thDesc.textContent = t('thDesc');
            const thStatus = document.getElementById('thStatus');
            if (thStatus) thStatus.textContent = t('thStatus');
            const thPackQty = document.getElementById('thPackQty');
            if (thPackQty) thPackQty.textContent = t('thPackQty');
            const thQuantity = document.getElementById('thQuantity');
            if (thQuantity) thQuantity.textContent = t('thQuantity');
            const thAction = document.getElementById('thAction');
            if (thAction) thAction.textContent = t('thAction');
            const pppLabel = document.getElementById('pppLabel');
            if (pppLabel) pppLabel.textContent = t('ppp');
            const loadingText = document.getElementById('loadingText');
            if (loadingText) loadingText.textContent = (currentLanguage === 'en' ? 'Loading products...' : '√úr√ºnler y√ºkleniyor...');
            const orderSummaryTitle = document.getElementById('orderSummaryTitle');
            if (orderSummaryTitle) orderSummaryTitle.textContent = t('orderSummary');
            const backToBasketBtn = document.getElementById('backToBasketBtn');
            if (backToBasketBtn) backToBasketBtn.textContent = t('backToBasket');
            const continueToCustomerBtn = document.getElementById('continueToCustomerBtn');
            if (continueToCustomerBtn) continueToCustomerBtn.textContent = t('continueToCustomer');
            const customerInfoTitle = document.getElementById('customerInfoTitle');
            if (customerInfoTitle) customerInfoTitle.textContent = t('customerInfoTitle');
            const labelOrderNumber = document.getElementById('labelOrderNumber');
            if (labelOrderNumber) labelOrderNumber.textContent = t('labelOrderNumber');
            const labelCompanyName = document.getElementById('labelCompanyName');
            if (labelCompanyName) labelCompanyName.textContent = t('labelCompanyName');
            const labelContactPerson = document.getElementById('labelContactPerson');
            if (labelContactPerson) labelContactPerson.textContent = t('labelContactPerson');
            const labelEmail = document.getElementById('labelEmail');
            if (labelEmail) labelEmail.textContent = t('labelEmail');
            const labelPhone = document.getElementById('labelPhone');
            if (labelPhone) labelPhone.textContent = t('labelPhone');
            const labelAdditionalNotes = document.getElementById('labelAdditionalNotes');
            if (labelAdditionalNotes) labelAdditionalNotes.textContent = t('labelAdditionalNotes');
            const backToSummaryBtn = document.getElementById('backToSummaryBtn');
            if (backToSummaryBtn) backToSummaryBtn.textContent = t('backToSummary');
            const submitOrderBtn = document.getElementById('submitOrderBtn');
            if (submitOrderBtn) submitOrderBtn.querySelector('span').textContent = t('submitOrder');
            const orderSummaryBoxTitle = document.getElementById('orderSummaryBoxTitle');
            if (orderSummaryBoxTitle) orderSummaryBoxTitle.textContent = t('orderSummary');
            const orderSummaryBoxTitle2 = document.getElementById('orderSummaryBoxTitle2');
            if (orderSummaryBoxTitle2) orderSummaryBoxTitle2.textContent = t('orderSummary');
            // Order summary table headers
            const sumThCode = document.getElementById('sumThCode');
            if (sumThCode) sumThCode.textContent = t('thCode');
            const sumThDesc = document.getElementById('sumThDesc');
            if (sumThDesc) sumThDesc.textContent = t('thDesc');
            const sumThStatus = document.getElementById('sumThStatus');
            if (sumThStatus) sumThStatus.textContent = t('thStatus');
            const sumThQty = document.getElementById('sumThQty');
            if (sumThQty) sumThQty.textContent = t('thQuantity');
            const sumThCode2 = document.getElementById('sumThCode2');
            if (sumThCode2) sumThCode2.textContent = t('thCode');
            const sumThDesc2 = document.getElementById('sumThDesc2');
            if (sumThDesc2) sumThDesc2.textContent = t('thDesc');
            const sumThStatus2 = document.getElementById('sumThStatus2');
            if (sumThStatus2) sumThStatus2.textContent = t('thStatus');
            const sumThQty2 = document.getElementById('sumThQty2');
            if (sumThQty2) sumThQty2.textContent = t('thQuantity');
            // Summary labels
            const totalProductsLabel = document.getElementById('totalProductsLabel');
            if (totalProductsLabel) totalProductsLabel.textContent = t('totalProducts');
            const totalQuantityLabel = document.getElementById('totalQuantityLabel');
            if (totalQuantityLabel) totalQuantityLabel.textContent = t('totalQuantity');
            const totalProductsLabel2 = document.getElementById('totalProductsLabel2');
            if (totalProductsLabel2) totalProductsLabel2.textContent = t('totalProducts');
            const totalQuantityLabel2 = document.getElementById('totalQuantityLabel2');
            if (totalQuantityLabel2) totalQuantityLabel2.textContent = t('totalQuantity');
            
            // Welcome section elements
            const welcomeTitle = document.getElementById('welcomeTitle');
            if (welcomeTitle) welcomeTitle.textContent = t('welcomeTitle');
            const welcomeSubtitle = document.getElementById('welcomeSubtitle');
            if (welcomeSubtitle) welcomeSubtitle.textContent = t('welcomeSubtitle');
            const step1Title = document.getElementById('step1Title');
            if (step1Title) step1Title.textContent = t('step1Title');
            const step1Desc = document.getElementById('step1Desc');
            if (step1Desc) step1Desc.textContent = t('step1Desc');
            const step2Title = document.getElementById('step2Title');
            if (step2Title) step2Title.textContent = t('step2Title');
            const step2Desc = document.getElementById('step2Desc');
            if (step2Desc) step2Desc.textContent = t('step2Desc');
            const step3Title = document.getElementById('step3Title');
            if (step3Title) step3Title.textContent = t('step3Title');
            const step3Desc = document.getElementById('step3Desc');
            if (step3Desc) step3Desc.textContent = t('step3Desc');
            const startBtnText = document.getElementById('startBtnText');
            if (startBtnText) startBtnText.textContent = t('startBtnText');
            const helpBtnText = document.getElementById('helpBtnText');
            if (helpBtnText) helpBtnText.textContent = t('helpBtnText');
            
            // Help button title and text
            const helpButton = document.getElementById('btnHelp');
            if (helpButton) helpButton.title = t('helpButtonTitle');
            const helpButtonText = document.getElementById('helpButtonText');
            if (helpButtonText) helpButtonText.textContent = t('helpButtonText');
            
            // Don't show welcome text
            const dontShowText = document.getElementById('dontShowText');
            if (dontShowText) dontShowText.textContent = t('dontShowText');
            
            // Catalog button text
            const catalogBtnText = document.getElementById('catalogBtnText');
            if (catalogBtnText) catalogBtnText.textContent = t('catalogBtnText');
            
            // Language selection elements
            const languageSelectionTitle = document.getElementById('languageSelectionTitle');
            if (languageSelectionTitle) languageSelectionTitle.textContent = t('languageSelectionTitle');
            const languageSelectionSubtitle = document.getElementById('languageSelectionSubtitle');
            if (languageSelectionSubtitle) languageSelectionSubtitle.textContent = t('languageSelectionSubtitle');
            
            // Quantity modal elements
            const quantityModalLabel = document.getElementById('quantityModalLabel');
            if (quantityModalLabel) quantityModalLabel.textContent = t('quantityLabel');
            const quantityInput = document.getElementById('quantityInput');
            if (quantityInput) quantityInput.placeholder = t('enterQuantity');
            
            // MOQ modal elements
            const moqModalTitle = document.getElementById('moqModalTitle');
            if (moqModalTitle) moqModalTitle.textContent = t('moqExceptionTitle');
            const moqModalInfoText = document.getElementById('moqModalInfoText');
            if (moqModalInfoText) moqModalInfoText.textContent = t('moqExceptionInfo');
            const moqModalNoteText = document.getElementById('moqModalNoteText');
            if (moqModalNoteText) moqModalNoteText.textContent = t('moqExceptionNote');
            const moqModalChooseText = document.getElementById('moqModalChooseText');
            if (moqModalChooseText) moqModalChooseText.textContent = t('moqExceptionChoose');
            const moqOptionStockTitle = document.getElementById('moqOptionStockTitle');
            if (moqOptionStockTitle) moqOptionStockTitle.textContent = t('moqOptionStockTitle');
            const moqOptionStockDesc = document.getElementById('moqOptionStockDesc');
            if (moqOptionStockDesc) moqOptionStockDesc.textContent = '';
            const moqOptionMOQTitle = document.getElementById('moqOptionMOQTitle');
            if (moqOptionMOQTitle) moqOptionMOQTitle.textContent = t('moqOptionMOQTitle');
            const moqOptionMOQDesc = document.getElementById('moqOptionMOQDesc');
            if (moqOptionMOQDesc) {
                moqOptionMOQDesc.textContent = '';
            }
            
            // reCAPTCHA modal elements
            const recaptchaModalTitle = document.getElementById('recaptchaModalTitle');
            if (recaptchaModalTitle) recaptchaModalTitle.textContent = t('recaptchaTitle');
            const recaptchaModalDesc = document.getElementById('recaptchaModalDesc');
            if (recaptchaModalDesc) recaptchaModalDesc.textContent = t('recaptchaDesc');
            const recaptchaModalCancel = document.getElementById('recaptchaModalCancel');
            if (recaptchaModalCancel) recaptchaModalCancel.textContent = t('recaptchaCancel');
            const recaptchaModalVerify = document.getElementById('recaptchaModalVerify');
            if (recaptchaModalVerify) recaptchaModalVerify.textContent = t('recaptchaVerify');
            
            // Order confirmation screen elements
            const confirmationTitle = document.getElementById('confirmationTitle');
            if (confirmationTitle) confirmationTitle.textContent = t('confirmationTitle');
            const confirmationMessage = document.getElementById('confirmationMessage');
            if (confirmationMessage) confirmationMessage.textContent = t('confirmationMessage');
            const confirmationOrderNumberLabel = document.getElementById('confirmationOrderNumberLabel');
            if (confirmationOrderNumberLabel) confirmationOrderNumberLabel.textContent = t('confirmationOrderNumberLabel');
            const confirmationDateLabel = document.getElementById('confirmationDateLabel');
            if (confirmationDateLabel) confirmationDateLabel.textContent = t('confirmationDateLabel');
            const confirmationEmailLabel = document.getElementById('confirmationEmailLabel');
            if (confirmationEmailLabel) confirmationEmailLabel.textContent = t('confirmationEmailLabel');
            const confirmationNewOrder = document.getElementById('confirmationNewOrder');
            if (confirmationNewOrder) confirmationNewOrder.textContent = t('confirmationNewOrder');
            const confirmationHome = document.getElementById('confirmationHome');
            if (confirmationHome) confirmationHome.textContent = t('confirmationHome');
            const moqModalCancelBtn = document.getElementById('moqModalCancelBtn');
            if (moqModalCancelBtn) moqModalCancelBtn.textContent = t('moqCancel');
            const moqModalProceedBtn = document.getElementById('moqModalProceedBtn');
            if (moqModalProceedBtn) moqModalProceedBtn.textContent = t('moqProceed');
        }

        function updateLangButtons() {
            const btnTr = document.getElementById('btnLangTrTop');
            const btnEn = document.getElementById('btnLangEnTop');
            
            // Add double-click to reset "Don't show welcome" setting
            if (btnTr) {
                btnTr.addEventListener('dblclick', function() {
                    localStorage.removeItem('rfq_dont_show_welcome');
                    console.log('Welcome screen setting reset - will show again');
                    showNotification('Settings Reset', 'Welcome screen will be shown again on next visit', 'info');
                });
            }
            if (btnEn) {
                btnEn.addEventListener('dblclick', function() {
                    localStorage.removeItem('rfq_dont_show_welcome');
                    console.log('Welcome screen setting reset - will show again');
                    showNotification('Settings Reset', 'Welcome screen will be shown again on next visit', 'info');
                });
            }
            if (!btnTr || !btnEn) return;
            if (currentLanguage === 'tr') {
                btnTr.classList.add('active');
                btnEn.classList.remove('active');
            } else {
                btnEn.classList.add('active');
                btnTr.classList.remove('active');
            }
        }
        
        // Check if product status matches filter
        function getStatusMatch(productStatus, filterStatus) {
            const productStatusLower = productStatus.toLowerCase();
            const filterStatusLower = filterStatus.toLowerCase();
            
            if (filterStatusLower === 'active') {
                return productStatusLower === 'active';
            } else if (filterStatusLower === 'inactive') {
                return productStatusLower === 'inactive';
            } else if (filterStatusLower === 'unknown') {
                return productStatusLower !== 'active' && productStatusLower !== 'inactive';
            }
            
            return false;
        }
        
        
        // Check if product is popular (popularity field is "yes")
        function isPopularProduct(product) {
            return product.popularity && product.popularity.toLowerCase() === 'yes';
        }
        
        // Pagination functions
        function changePage(direction) {
            const sortedProducts = [...window.filteredProducts].sort((a, b) => {
                const codeA = (a.product_code || '').toLowerCase();
                const codeB = (b.product_code || '').toLowerCase();
                return codeA.localeCompare(codeB);
            });
            const totalPages = Math.ceil(sortedProducts.length / productsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                displayProducts(window.filteredProducts);
            }
        }
        
        function updatePaginationControls(totalPages) {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const pageInfo = document.getElementById('pageInfo');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            // Update bottom controls if present
            const prevBtnBottom = document.getElementById('prevBtnBottom');
            const nextBtnBottom = document.getElementById('nextBtnBottom');
            const pageInfoBottom = document.getElementById('pageInfoBottom');
            if (prevBtnBottom && nextBtnBottom && pageInfoBottom) {
                prevBtnBottom.disabled = currentPage <= 1;
                nextBtnBottom.disabled = currentPage >= totalPages;
                pageInfoBottom.textContent = `Page ${currentPage} of ${totalPages}`;
            }
        }
        
        function changeProductsPerPage() {
            const newPerPage = parseInt(document.getElementById('productsPerPage').value);
            productsPerPage = newPerPage;
            currentPage = 1; // Reset to first page
            displayProducts(window.filteredProducts || allProducts);
        }
        
        // Helper function to add product to order
        function addProductToOrder(product, quantity) {
            // Handle MOQ of 0
            const moq = parseInt(product.moq) || 1;
            const packingQty = parseInt(product.packing_qty) || 1;
            
            // If below MOQ, show MOQ modal
            if (parseInt(product.moq) > 0 && parseInt(quantity) < moq) {
                // But still must match packing qty
                if (parseInt(product.packing_qty) > 0 && parseInt(quantity) % packingQty !== 0) {
                    alert(`${t('quantityMultiplesError')} ${product.packing_qty}`);
                    return;
                }
                showMOQModal(product, quantity, -1); // Use -1 for filtered products
                return;
            }
            
            if (parseInt(product.packing_qty) > 0 && parseInt(quantity) % packingQty !== 0) {
                alert(`${t('quantityMultiplesError')} ${product.packing_qty}`);
                return;
            }
            
            // Check if product already exists in order
            const existingIndex = orderItems.findIndex(item => 
                item.product_code === product.product_code
            );
            
            if (existingIndex !== -1) {
                // Update quantity if product already exists
                orderItems[existingIndex].quantity = parseInt(orderItems[existingIndex].quantity) + parseInt(quantity);
                showMessage('Product quantity updated in order', 'success');
            } else {
                // Add new product to order
                const orderItem = {
                    ...product,
                    quantity: quantity,
                    orderIndex: orderItems.length
                };
                
                orderItems.push(orderItem);
                showMessage('Product added to order', 'success');
            }
            
            updateBasket();
        }
        
        // Add product to order from display (using product code)
        function addToOrderFromDisplay(productCode) {
            // Find the product in allProducts first
            let product = allProducts.find(p => p.product_code === productCode);
            
            // If not found in allProducts, try filteredProducts
            if (!product && window.filteredProducts) {
                product = window.filteredProducts.find(p => p.product_code === productCode);
            }
            
            if (!product) {
                alert('Product not found. Please refresh the page.');
                return;
            }
            
            // Find the quantity input in the same row as the button
            const button = event.target;
            const row = button.closest('tr');
            const quantityInputInRow = row.querySelector('input[id^="qty-"]');
            
            const quantity = quantityInputInRow ? quantityInputInRow.value : '';
            
            if (!quantity) {
                alert(t('quantityRequiredError'));
                return;
            }
            
            // Use the helper function
            addProductToOrder(product, quantity);
            
            // Clear the input
            if (quantityInputInRow) {
                quantityInputInRow.value = '';
            }
        }
        
        // Add product to order
        function addToOrder(index) {
            const product = allProducts[index];
            
            if (!product) {
                console.error('Product not found at index:', index);
                // Try to find the product in filteredProducts using the current page
                const currentPageProducts = window.filteredProducts ? 
                    window.filteredProducts.slice((currentPage - 1) * productsPerPage, currentPage * productsPerPage) : [];
                const pageIndex = index % productsPerPage;
                const filteredProduct = currentPageProducts[pageIndex];
                
                if (filteredProduct) {
                    console.log('Found product in filteredProducts, using that instead');
                    // Use the filtered product directly
                    addProductToOrder(filteredProduct, quantity);
                    return;
                }
                alert('Product not found. Please refresh the page.');
                return;
            }
            
            const quantity = document.getElementById(`qty-${index}`).value;
            console.log('quantity:', quantity);
            
            if (!quantity) {
                alert(t('quantityRequiredError'));
                return;
            }
            
            // Use the helper function
            addProductToOrder(product, quantity);
            
            // Clear the input
            document.getElementById(`qty-${index}`).value = '';
            
            // Check if product is inactive or unknown and show alternative suggestions
            const productStatus = product.status.toLowerCase();
            if (productStatus === 'inactive' || productStatus === 'unknown') {
                showAlternativeModal(product);
            }
        }
        
        // Update basket display
        function updateBasket() {
            const basketItems = document.getElementById('basketItems');
            const basketItemCount = document.getElementById('basketItemCount');
            const basketTotalItems = document.getElementById('basketTotalItems');
            const toggle = document.getElementById('basketToggle');
            
            // Update counts
            basketItemCount.textContent = orderItems.length;
            const totalQty = orderItems.reduce((sum, item) => sum + parseInt(item.quantity), 0);
            basketTotalItems.textContent = totalQty;
            
            // Update collapsed count
            if (toggle) {
                toggle.setAttribute('data-count', orderItems.length);
            }
            
            if (orderItems.length === 0) {
                basketItems.innerHTML = '<div class="basket-empty">No products added yet</div>';
                return;
            }
            
            basketItems.innerHTML = orderItems.map((item, index) => {
                const statusClass = getStatusClass(item.status);
                const alternatives = item.requestedAlternatives || [];
                const alternativesText = alternatives.length > 0 ? 
                    `<div class="basket-alternatives">üí° Alternatives: ${alternatives.map(alt => {
                        const labels = {
                            'color': 'Different Color',
                            'size': 'Different Size',
                            'similar-size': 'Similar Size',
                            'similar-product': 'Similar Product',
                            'remove': 'Remove if Unavailable'
                        };
                        return labels[alt] || alt;
                    }).join(', ')}</div>` : '';
                // MOQ Exception info
                let moqExceptionText = '';
                if (item.moqException === 'stock') {
                    moqExceptionText = `<div class="basket-alternatives" style="color:#856404; font-weight:bold; background:#fff3cd; border-left:3px solid #ffc107; margin-top:4px;">‚ö†Ô∏è ${t('moqStockMessage')}</div>`;
                } else if (item.moqException === 'moq') {
                    moqExceptionText = `<div class="basket-alternatives" style="color:#007bff; font-weight:bold; background:#e3f0ff; border-left:3px solid #007bff; margin-top:4px;">‚¨ÜÔ∏è ${t('moqIncreasedMessage')} (${item.moq} adet)</div>`;
                }
                return `
                    <div class="basket-item ${statusClass}">
                        <div class="basket-item-info">
                            <div class="basket-item-code">${item.canias_code || item.product_code}</div>
                            <div class="basket-item-desc">${getLocalizedDescription(item)}</div>
                            <div class="basket-item-status ${statusClass}">${t('statusLabel')} ${getLocalizedStatus(item.status)}</div>
                            ${alternativesText}
                            ${moqExceptionText}
                        </div>
                        <div class="basket-item-qty">${item.quantity}</div>
                        <button class="basket-item-remove" onclick="removeFromBasket(${index})">√ó</button>
                    </div>
                `;
            }).join('');
        }
        
        // Remove item from basket
        function removeFromBasket(index) {
            orderItems.splice(index, 1);
            updateBasket();
            showMessage('Product removed from order', 'success');
        }
        
        // Clear all items from basket
        function clearBasket() {
            if (orderItems.length === 0) {
                alert('Basket is already empty');
                return;
            }
            
            if (confirm('Are you sure you want to clear all items from your order?')) {
                orderItems = [];
                updateBasket();
                showMessage('Basket cleared', 'success');
            }
        }
        
        // Toggle basket collapse/expand
        function toggleBasket() {
            const basket = document.querySelector('.basket-area-box');
            const toggle = document.getElementById('basketToggle');
            
            basketCollapsed = !basketCollapsed;
            
            if (basketCollapsed) {
                basket.classList.add('collapsed');
                // Update tooltip and count
                toggle.title = 'Expand Basket';
                toggle.setAttribute('data-count', orderItems.length);
            } else {
                basket.classList.remove('collapsed');
                // Update tooltip
                toggle.title = 'Collapse Basket';
            }
        }
        
        // Add click event to collapsed basket
        document.addEventListener('DOMContentLoaded', function() {
            const basketContainer = document.getElementById('basketContainer');
            
            if (basketContainer) {
                basketContainer.addEventListener('click', function(e) {
                    // Only trigger if basket is collapsed and click is not on the toggle button
                    if (basketCollapsed && !e.target.closest('.basket-toggle')) {
                        toggleBasket();
                    }
                });
            }
        });
        
        // Scroll to customer form
        function scrollToCustomerForm() {
            if (orderItems.length === 0) {
                alert('Please add at least one product to your order first');
                return;
            }
            
            // Update the order summary section with all basket items
            updateOrderSummaryDisplay();
            
            // Scroll to the customer form section
            document.querySelector('.customer-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        // Update order summary display in the customer form section
        function updateOrderSummaryDisplay() {
            const orderSummaryBody = document.getElementById('orderSummaryBodyModal');
            
            if (!orderSummaryBody) {
                console.warn('orderSummaryBodyModal element not found');
                return;
            }
            
            if (orderItems.length === 0) {
                orderSummaryBody.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">No products in your order</p>';
                return;
            }
            
            let summaryHTML = `
                <div style="overflow-x: auto; margin-bottom: 20px;">
                    <table class="summary-table" style="width: 100%; min-width: 600px;">
                        <thead>
                            <tr>
                                <th id="sumThCode">${t('thCode')}</th>
                                <th id="sumThDesc">${t('thDesc')}</th>
                                <th id="sumThStatus">${t('thStatus')}</th>
                                <th id="sumThQty">${t('thQuantity')}</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            orderItems.forEach((item, index) => {
                const statusClass = getStatusClass(item.status);
                const alternatives = item.requestedAlternatives || [];
                let alternativesBadge = '';
                if (alternatives.length > 0) {
                    alternativesBadge = `<div class=\"basket-alternatives\" style=\"color:#007bff; font-weight:bold; background:#f8f9ff; border-left:3px solid #007bff; margin-top:4px;\">üí° Alternatives: ${alternatives.map(alt => {
                        const labels = {
                            'color': 'Different Color',
                            'size': 'Different Size',
                            'similar-size': 'Similar Size',
                            'similar-product': 'Similar Product',
                            'remove': 'Remove if Unavailable'
                        };
                        return labels[alt] || alt;
                    }).join(', ')}</div>`;
                }
                // MOQ Exception info
                let moqExceptionBadge = '';
                if (item.moqException === 'stock') {
                    moqExceptionBadge = `<div class=\"basket-alternatives\" style=\"color:#856404; font-weight:bold; background:#fff3cd; border-left:3px solid #ffc107; margin-top:4px;\">‚ö†Ô∏è ${t('moqStockMessage')}</div>`;
                } else if (item.moqException === 'moq') {
                    moqExceptionBadge = `<div class=\"basket-alternatives\" style=\"color:#007bff; font-weight:bold; background:#e3f0ff; border-left:3px solid #007bff; margin-top:4px;\">‚¨ÜÔ∏è ${t('moqIncreasedMessage')} (${item.moq} adet)</div>`;
                }
                summaryHTML += `
                    <tr>
                        <td><strong>${item.canias_code || item.product_code}</strong></td>
                        <td>${getLocalizedDescription(item)}<span class='product-img-emoji' onmouseenter="showProductImgPreview(event, 'https://www.dogukanlevent.com/RFQ-Web/PHLogo.png')" onmouseleave="hideProductImgPreview()">üñºÔ∏è</span>${alternativesBadge}${moqExceptionBadge}</td>
                        <td class=\"${statusClass}\">${getLocalizedStatus(item.status)}</td>
                        <td><strong>${item.quantity}</strong></td>
                    </tr>
                `;
            });
            
            summaryHTML += `
                        </tbody>
                    </table>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #495057;" id="orderSummaryBoxTitle">${t('orderSummary')}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong id="totalProductsLabel">${t('totalProducts')}</strong> ${orderItems.length}
                        </div>
                        <div>
                            <strong id="totalQuantityLabel">${t('totalQuantity')}</strong> ${orderItems.reduce((sum, item) => sum + parseInt(item.quantity), 0)}
                        </div>
                    </div>
                </div>
            `;
            
            orderSummaryBody.innerHTML = summaryHTML;
        }
        
        // Update order summary (legacy function - now redirects to basket)
        function updateOrderSummary() {
            updateBasket();
        }
        
        // Remove item from order (legacy function - now redirects to basket)
        function removeFromOrder(index) {
            removeFromBasket(index);
        }
        
        // Save order draft to localStorage
        function saveOrderDraft() {
            if (orderItems.length === 0) {
                alert('No items to save');
                return;
            }
            
            const orderDraft = {
                items: orderItems.map(item => ({
                    ...item,
                    requestedAlternatives: item.requestedAlternatives || []
                })),
                savedDate: new Date().toISOString(),
                customerData: {
                    company: document.querySelector('input[name="company"]').value,
                    contact: document.querySelector('input[name="contact"]').value,
                    email: document.querySelector('input[name="email"]').value,
                    phone: document.querySelector('input[name="phone"]').value,
                    notes: document.querySelector('textarea[name="notes"]').value
                }
            };
            
            localStorage.setItem('orderDraft', JSON.stringify(orderDraft));
            showMessage('Order draft saved successfully', 'success');
        }
        
        // Load order draft from localStorage
        function loadOrderDraft() {
            const saved = localStorage.getItem('orderDraft');
            if (!saved) {
                alert('No saved draft found');
                return;
            }
            
            try {
                const draft = JSON.parse(saved);
                orderItems = draft.items;
                updateBasket(); // Update the basket display
                updateOrderSummaryDisplay(); // Update the order summary display
                
                // Restore customer data if available
                if (draft.customerData) {
                    document.querySelector('input[name="company"]').value = draft.customerData.company || '';
                    document.querySelector('input[name="contact"]').value = draft.customerData.contact || '';
                    document.querySelector('input[name="email"]').value = draft.customerData.email || '';
                    document.querySelector('input[name="phone"]').value = draft.customerData.phone || '';
                    document.querySelector('textarea[name="notes"]').value = draft.customerData.notes || '';
                }
                
                const savedDate = new Date(draft.savedDate).toLocaleString();
                showMessage(`Draft loaded from ${savedDate}`, 'success');
            } catch (error) {
                alert('Error loading draft');
                console.error(error);
            }
        }
        
        // Submit form
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (orderItems.length === 0) {
                alert('Please add at least one product to your order');
                return;
            }
            
            // Gather form data
            const formData = new FormData(e.target);
            const customerInfo = {};
            for (let [key, value] of formData.entries()) {
                customerInfo[key] = value;
            }
            
            
            // Prepare order data
            const orderData = {
                orderNumber: 'ORD-' + Date.now(),
                orderDate: new Date().toLocaleString(),
                customer: customerInfo,
                items: orderItems.map(item => ({
                    productCode: item.product_code,
                    description: getLocalizedDescription(item),
                    category: item.category,
                    quantity: item.quantity,
                    color: item.colors || 'Default',
                    packingQty: item.packing_qty,
                    moq: item.moq,
                    status: item.status,
                    caniasCode: item.canias_code,
                    shortCode: item.short_code,
                    requestedAlternatives: item.requestedAlternatives || [],
                    moqException: item.moqException
                }))
            };
            
            // Add CSV data to orderData for EmailJS template
            orderData.csv_data = generateCSVData(orderData);
            
            // Format email body
            const emailBody = formatEmailBody(orderData);
            
            // Show reCAPTCHA modal instead of directly sending email
            showRecaptchaModal({
                customerInfo: customerInfo,
                emailBody: emailBody,
                orderData: orderData
            });
        });
        
        // Format email body
        function formatEmailBody(orderData) {
            let body = `
NEW QUOTE REQUEST
=================
Request Number: ${orderData.orderNumber}
Date: ${orderData.orderDate}

CUSTOMER INFORMATION:
--------------------
Company: ${orderData.customer.company}
Contact: ${orderData.customer.contact}
Email: ${orderData.customer.email}
Phone: ${orderData.customer.phone || 'Not provided'}

ORDER DETAILS:
--------------
`;
            
            orderData.items.forEach((item, index) => {
                body += `${index + 1}. ${item.caniasCode || item.productCode} - ${item.description}
   Quantity: ${item.quantity}`;
                
                // Add MOQ modal note if applicable
                if (item.moqException) {
                    const moqNote = item.moqException === 'stock' ? 
                        'Stock check requested' : 
                        'MOQ increased to ' + item.moq;
                    body += `
   Note: ${moqNote}`;
                }
                
                body += `

`;
            });
            
            if (orderData.customer.notes) {
                body += `
ADDITIONAL NOTES:
-----------------
${orderData.customer.notes}
`;
            }
            
            // Add CSV data for ERP integration
            body += `

=== CSV DATA FOR ERP IMPORT ===
===============================
${generateCSVData(orderData)}
`;
            
            return body;
        }
        
        // Generate text-based table optimized for column copying
        function generateOrderDetailsTable(orderData) {
            if (!orderData.items || orderData.items.length === 0) {
                return '<p>No items in order.</p>';
            }
            
            // Generate HTML table rows for each item
            const tableRows = orderData.items.map(item => {
                const moqNote = item.moqException ? 
                    (item.moqException === 'stock' ? ' (Stok kontrol√º talep edildi)' : ` (MOQ ${item.moq}'a y√ºkseltildi)`) : 
                    '';
                const productCode = item.caniasCode || item.productCode || 'N/A';
                const productDescription = item.description + moqNote;
                const quantity = item.quantity.toString();
                
                return `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px; vertical-align: top; width: 15%;">${productCode}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; vertical-align: top; width: 60%; word-wrap: break-word;">${productDescription}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; vertical-align: top; width: 15%; text-align: center;">${quantity}</td>
                    </tr>
                `;
            }).join('');
            
            // Return complete HTML table structure
            return `
                <table border="1" cellpadding="8" cellspacing="0" width="100%" style="border-collapse: collapse; font-family: Arial, sans-serif; font-size: 13px; background-color: #fff;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th align="left" style="border: 1px solid #ddd; padding: 8px; font-weight: bold; width: 15%;">Kod</th>
                            <th align="left" style="border: 1px solid #ddd; padding: 8px; font-weight: bold; width: 60%;">√úr√ºn Adƒ±</th>
                            <th align="center" style="border: 1px solid #ddd; padding: 8px; font-weight: bold; width: 15%;">Miktar</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
        }
        
        // Send email via EmailJS
        async function sendEmailViaEmailJS(orderData) {
            try {
                // Generate text-based table for the email template
                const orderDetails = generateOrderDetailsTable(orderData);

                const templateParams = {
                    order_number: orderData.orderNumber,
                    order_date: orderData.orderDate,
                    customer_company: orderData.customer.company,
                    customer_contact: orderData.customer.contact,
                    customer_email: orderData.customer.email,
                    customer_phone: orderData.customer.phone,
                    customer_notes: orderData.customer.notes || '',
                    order_details: orderDetails,
                    total_products: orderData.items.length,
                    total_quantity: orderData.items.reduce((sum, item) => sum + item.quantity, 0)
                };
                
                
                console.log('Starting EmailJS send...');
                console.log('Service ID:', EMAILJS_CONFIG.serviceId);
                console.log('Template ID:', EMAILJS_CONFIG.templateId);
                console.log('Template Parameters:', templateParams);
                
                const result = await emailjs.send(
                    EMAILJS_CONFIG.serviceId,
                    EMAILJS_CONFIG.templateId,
                    templateParams
                );
                
                console.log('EmailJS Response:', result);
                
                return {
                    success: true,
                    orderNumber: orderData.orderNumber,
                    messageId: result.text
                };
                
            } catch (error) {
                console.error('EmailJS Send Error:', error);
                throw error;
            }
        }
        
        // Send email function
        async function sendEmail(customerEmail, emailBody, orderData) {
            try {
                // Show loading message
                showMessage('Sending your order via EmailJS...', 'success');
                
                // Check if EmailJS is configured
                if (!window.EMAILJS_CONFIG || EMAILJS_CONFIG.serviceId === 'YOUR_SERVICE_ID') {
                    throw new Error('EmailJS not configured. Please set up your EmailJS credentials.');
                }
                
                // Check if EmailJS library is loaded
                if (typeof emailjs === 'undefined') {
                    throw new Error('EmailJS library not loaded. Please check your internet connection.');
                }
                
                console.log('EmailJS Config:', EMAILJS_CONFIG);
                console.log('Order Data:', orderData);
                
                // Send email via EmailJS
                const result = await sendEmailViaEmailJS(orderData);
                
                if (result.success) {
                    // Show order confirmation screen
                    console.log('EmailJS success! About to call showOrderConfirmation with orderNumber:', result.orderNumber);
                    showOrderConfirmation(result.orderNumber);
                } else {
                    throw new Error(result.message || 'Failed to send order');
                }
                
            } catch (error) {
                console.error('EmailJS Error Details:', error);
                console.error('Error Stack:', error.stack);
                
                // Even if EmailJS fails, show confirmation screen since email might have been sent
                console.log('EmailJS failed, but showing confirmation screen anyway');
                console.log('About to call showOrderConfirmation with orderNumber:', orderData.orderNumber);
                showOrderConfirmation(orderData.orderNumber);
                
                // Show a subtle warning that there might have been an issue
                setTimeout(() => {
                    showMessage('Order submitted! If you don\'t receive a confirmation email within a few minutes, please contact us directly.', 'success');
                }, 2000);
            }
        }
        
        // Download order summary as text file
        function downloadOrderSummary(orderData) {
            const content = formatEmailBody(orderData);
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Order_${orderData.orderNumber}_${orderData.customer.company.replace(/\s+/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
        
        // Export order as CSV
        function exportOrderAsCSV() {
            if (orderItems.length === 0) {
                alert('No items in order');
                return;
            }
            
            let csv = 'Product Code,Description,Category,Quantity,Color,MOQ,Packing Qty,Status,Alternative Requests\n';
            
            orderItems.forEach(item => {
                const alternatives = item.requestedAlternatives && item.requestedAlternatives.length > 0 ? 
                    item.requestedAlternatives.map(alt => {
                        const labels = {
                            'color': 'Different Color',
                            'size': 'Different Size',
                            'similar-size': 'Similar Size',
                            'similar-product': 'Similar Product',
                            'remove': 'Remove if Unavailable'
                        };
                        return labels[alt] || alt;
                    }).join('; ') : '';
                
                csv += `"${item.product_code}","${getLocalizedDescription(item)}","${item.category}",${item.quantity},"${item.colors || 'Default'}",${item.moq},${item.packing_qty},"${item.status}","${alternatives}"\n`;
            });
            
            // Add customer info at the bottom
            csv += '\n\nCustomer Information\n';
            csv += `Company,${document.querySelector('input[name="company"]').value}\n`;
            csv += `Contact,${document.querySelector('input[name="contact"]').value}\n`;
            csv += `Email,${document.querySelector('input[name="email"]').value}\n`;
            csv += `Phone,${document.querySelector('input[name="phone"]').value}\n`;
            csv += `Notes,"${document.querySelector('textarea[name="notes"]').value}"\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Order_Export_${new Date().getTime()}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showMessage('Order exported as CSV', 'success');
        }
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+S to save draft
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveOrderDraft();
            }
        });
        
        // Fix tooltip positioning
        document.addEventListener('mouseover', function(e) {
            if (e.target.classList.contains('status-tooltip-icon')) {
                const tooltip = e.target.querySelector('.status-tooltip-popup');
                if (tooltip) {
                    const rect = e.target.getBoundingClientRect();
                    const tooltipWidth = 240; // min-width from CSS
                    const tooltipHeight = 80; // estimated height
                    
                    // Position tooltip to the right of the icon, slightly above
                    let left = rect.right + 10; // 10px to the right of the icon
                    let top = rect.top - 20; // slightly above the icon
                    
                    // If tooltip would go off the right edge, position it to the left
                    if (left + tooltipWidth > window.innerWidth - 10) {
                        left = rect.left - tooltipWidth - 10;
                    }
                    
                    // If tooltip would go off the top, position it below
                    if (top < 10) {
                        top = rect.bottom + 10;
                    }
                    
                    // If tooltip would go off the bottom, position it higher
                    if (top + tooltipHeight > window.innerHeight - 10) {
                        top = window.innerHeight - tooltipHeight - 10;
                    }
                    
                    tooltip.style.left = left + 'px';
                    tooltip.style.top = top + 'px';
                    tooltip.style.transform = 'none';
                }
            }
        });
        
        // Show alternative product suggestion modal
        function showAlternativeModal(product) {
            currentAlternativeProduct = product;
            selectedAlternatives = [];
            
            // Update modal content
            document.getElementById('modalProductName').textContent = product.product_code + ' - ' + product.description;
            document.getElementById('modalProductStatus').textContent = `${t('statusLabel')} ${getLocalizedStatus(product.status)}`;
            
            // Update product info styling based on status
            const productInfo = document.getElementById('alternativeProductInfo');
            productInfo.className = 'alternative-product-info ' + product.status.toLowerCase();
            
            // Reset option selections
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Update selected count
            updateSelectedCount();
            
            // Show modal
            document.getElementById('alternativeModal').style.display = 'flex';
        }
        
        // Close alternative modal
        function closeAlternativeModal() {
            document.getElementById('alternativeModal').style.display = 'none';
            currentAlternativeProduct = null;
            selectedAlternatives = [];
        }
        
        // Toggle option selection
        function toggleOption(optionElement) {
            const option = optionElement.dataset.option;
            const isSelected = optionElement.classList.contains('selected');
            
            // Handle "Remove if Unavailable" option - it's mutually exclusive with others
            if (option === 'remove') {
                if (isSelected) {
                    // Deselect remove option
                    optionElement.classList.remove('selected');
                    selectedAlternatives = selectedAlternatives.filter(alt => alt !== option);
                } else {
                    // Select remove option and deselect all others
                    document.querySelectorAll('.option-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    selectedAlternatives = ['remove'];
                    optionElement.classList.add('selected');
                }
            } else {
                // Handle other options
                if (isSelected) {
                    // Deselect this option
                    optionElement.classList.remove('selected');
                    selectedAlternatives = selectedAlternatives.filter(alt => alt !== option);
                } else {
                    // If "remove" is selected, deselect it first
                    const removeOption = document.querySelector('.option-item[data-option="remove"]');
                    if (removeOption.classList.contains('selected')) {
                        removeOption.classList.remove('selected');
                        selectedAlternatives = selectedAlternatives.filter(alt => alt !== 'remove');
                    }
                    
                    // Select this option
                    optionElement.classList.add('selected');
                    selectedAlternatives.push(option);
                }
            }
            
            updateSelectedCount();
        }
        
        // Update selected count display
        function updateSelectedCount() {
            const count = selectedAlternatives.length;
            const hasRemove = selectedAlternatives.includes('remove');
            const total = 5;
            
            let message = '';
            if (hasRemove) {
                message = `Selected: Remove if Unavailable (1/5) - Mutually exclusive with alternatives`;
            } else if (count === 0) {
                message = `Select your preferences (0/5) - You can choose multiple alternatives OR "Remove if Unavailable"`;
            } else {
                message = `Select your preferences (${count}/5) - You can choose multiple alternatives OR "Remove if Unavailable"`;
            }
            
            document.getElementById('selectedCount').textContent = message;
            
            // Enable/disable submit button
            const submitBtn = document.getElementById('submitAlternativeBtn');
            submitBtn.disabled = count === 0;
            
            if (count === 0) {
                submitBtn.textContent = 'Request Alternatives';
            } else if (hasRemove) {
                submitBtn.textContent = 'Confirm Removal Preference';
            } else {
                submitBtn.textContent = `Request ${count} Alternative${count > 1 ? 's' : ''}`;
            }
        }
        
        // Submit alternative request
        function submitAlternativeRequest() {
            if (!currentAlternativeProduct || selectedAlternatives.length === 0) {
                return;
            }
            
            // Find the product in the basket and add the alternatives
            const basketIndex = orderItems.findIndex(item => 
                item.product_code === currentAlternativeProduct.product_code
            );
            
            if (basketIndex !== -1) {
                orderItems[basketIndex].requestedAlternatives = [...selectedAlternatives];
                updateBasket(); // Refresh the basket display
            }
            
            // Create alternative request data
            const alternativeRequest = {
                originalProduct: {
                    code: currentAlternativeProduct.product_code,
                    description: currentAlternativeProduct.description,
                    status: currentAlternativeProduct.status,
                    category: currentAlternativeProduct.category
                },
                requestedAlternatives: selectedAlternatives,
                requestDate: new Date().toISOString(),
                customerInfo: {
                    company: document.querySelector('input[name="company"]').value || 'Not provided',
                    email: document.querySelector('input[name="email"]').value || 'Not provided'
                }
            };
            
            // Save to localStorage for tracking
            const existingRequests = JSON.parse(localStorage.getItem('alternativeRequests') || '[]');
            existingRequests.push(alternativeRequest);
            localStorage.setItem('alternativeRequests', JSON.stringify(existingRequests));
            
            // Show success message
            const alternativesText = selectedAlternatives.map(alt => {
                const labels = {
                    'color': 'Different Color',
                    'size': 'Different Size',
                    'similar-size': 'Similar Size',
                    'similar-product': 'Similar Product & Solution',
                    'remove': 'Remove if Unavailable'
                };
                return labels[alt] || alt;
            }).join(', ');
            
            showMessage(`Alternative request submitted! We'll contact you about: ${alternativesText}`, 'success');
            
            // Close modal
            closeAlternativeModal();
            
            // Optionally, you could also send this data to your server here
            // sendAlternativeRequestToServer(alternativeRequest);
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('alternativeModal');
            if (e.target === modal) {
                closeAlternativeModal();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAlternativeModal();
            }
        });
        
        let moqModalState = { product: null, requestedQty: 0, selected: null, productIndex: null };
        
        function showMOQModal(product, requestedQty, productIndex) {
            moqModalState = { product, requestedQty, selected: null, productIndex };
            const productName = getLocalizedDescription(product);
            
            // Set modal content with null checks
            const productNameEl = document.getElementById('moqModalProductName');
            const statusEl = document.getElementById('moqModalStatus');
            const moq2El = document.getElementById('moqModalMOQ2');
            const moq3El = document.getElementById('moqModalMOQ3');
            
            if (productNameEl) productNameEl.textContent = (product.canias_code || product.product_code) + ' - ' + productName;
            if (statusEl) statusEl.innerHTML = `MOQ: <span id='moqModalMOQ'>${product.moq}</span> | ${currentLanguage === 'tr' ? 'Talebiniz' : 'Your Request'}: <span id='moqModalRequested'>${requestedQty}</span>`;
            if (moq2El) moq2El.textContent = product.moq;
            if (moq3El) moq3El.textContent = product.moq;
            
            const modal = document.getElementById('moqModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.style.zIndex = '10000';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
            }
            
            const proceedBtn = document.getElementById('moqModalProceedBtn');
            const stockOption = document.getElementById('moqOptionStock');
            const moqOption = document.getElementById('moqOptionMOQ');
            
            if (proceedBtn) proceedBtn.disabled = true;
            if (stockOption) stockOption.classList.remove('selected');
            if (moqOption) moqOption.classList.remove('selected');
        }
        
        function selectMOQOption(option) {
            moqModalState.selected = option;
            document.getElementById('moqOptionStock').classList.toggle('selected', option === 'stock');
            document.getElementById('moqOptionMOQ').classList.toggle('selected', option === 'moq');
            document.getElementById('moqModalProceedBtn').disabled = false;
        }
        
        function closeMOQModal() {
            document.getElementById('moqModal').style.display = 'none';
            moqModalState = { product: null, requestedQty: 0, selected: null, productIndex: null };
        }
        
        function proceedMOQModal() {
            const { product, requestedQty, selected, productIndex } = moqModalState;
            if (!product || !selected) return;
            closeMOQModal();
            if (selected === 'stock') {
                // Add to basket with requestedQty and flag for stock check
                const orderItem = {
                    ...product,
                    quantity: requestedQty,
                    orderIndex: orderItems.length,
                    moqException: 'stock'
                };
                orderItems.push(orderItem);
                showMessage('Product added to order with stock check request', 'success');
            } else if (selected === 'moq') {
                // Add to basket with MOQ quantity
                const orderItem = {
                    ...product,
                    quantity: product.moq,
                    orderIndex: orderItems.length,
                    moqException: 'moq'
                };
                orderItems.push(orderItem);
                showMessage('Product added to order with MOQ quantity', 'success');
            }
            updateBasket();
            
            // Clear the quantity input if productIndex is valid
            if (productIndex !== -1) {
                const qtyInput = document.getElementById(`qty-${productIndex}`);
                if (qtyInput) qtyInput.value = '';
            } else {
                // For filtered products, find and clear the input by looking for the product code
                const productCode = product.product_code;
                const rows = document.querySelectorAll('tr');
                for (let row of rows) {
                    if (row.textContent.includes(productCode)) {
                        const qtyInput = row.querySelector('input[id^="qty-"]');
                        if (qtyInput) {
                            qtyInput.value = '';
                            break;
                        }
                    }
                }
            }
        }
        // Generate CSV data for ERP integration
        function generateCSVData(orderData) {
            const csvHeader = 'Product Code,Quantity,Description,Status,MOQ Exception\n';
            const csvRows = orderData.items.map(item => {
                const moqException = item.moqException ? 
                    (item.moqException === 'stock' ? 'Stock Check' : 'MOQ Increased') : 
                    'None';
                return `"${item.caniasCode || item.productCode}","${item.quantity}","${getLocalizedDescription(item)}","${item.status || 'Unknown'}","${moqException}"`;
            }).join('\n');
            
            return csvHeader + csvRows;
        }
        
        
        // Download CSV file for local use
        function downloadCSVFile(orderData) {
            const csvData = generateCSVData(orderData);
            const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `order_${orderData.orderNumber}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Update permanent basket
        function updateBasket() {
            // Update basket counts
            document.getElementById('basketItemCount').textContent = orderItems.length;
            document.getElementById('basketTotalItems').textContent = orderItems.reduce((sum, item) => sum + parseInt(item.quantity), 0);
            
            // Update collapsed count
            const toggle = document.getElementById('basketToggle');
            if (toggle) {
                toggle.setAttribute('data-count', orderItems.length);
            }
            
            // Render items in basket content
            const basketContent = document.getElementById('basketContent');
            if (orderItems.length === 0) {
                basketContent.innerHTML = `
                    <div class="cart-empty">
                        <div class="cart-empty-icon">üõí</div>
                        <div class="cart-empty-title">Your cart is empty</div>
                        <div class="cart-empty-subtitle">Start adding products to create your quote request</div>
                    </div>
                `;
                return;
            }
            basketContent.innerHTML = orderItems.map((item, index) => {
                const statusClass = getStatusClass(item.status);
                const alternatives = item.requestedAlternatives || [];
                const alternativesText = alternatives.length > 0 ? 
                    `<div class="cart-item-alternatives">üí° ${alternatives.map(alt => {
                        const labels = {
                            'color': 'Different Color',
                            'size': 'Different Size',
                            'similar-size': 'Similar Size',
                            'similar-product': 'Similar Product',
                            'remove': 'Remove if Unavailable'
                        };
                        return labels[alt] || alt;
                    }).join(', ')}</div>` : '';
                // MOQ Exception info
                let moqExceptionText = '';
                if (item.moqException === 'stock') {
                    moqExceptionText = `<div class="cart-item-moq" style="color:#856404; background:#fff3cd; padding:4px 8px; border-radius:8px;">‚ö†Ô∏è ${t('stockCheckRequested')}</div>`;
                } else if (item.moqException === 'moq') {
                    moqExceptionText = `<div class="cart-item-moq" style="color:#007bff; background:#e3f0ff; padding:4px 8px; border-radius:8px;">‚¨ÜÔ∏è MOQ: ${item.moq} adet</div>`;
                }
                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-code">${item.canias_code || item.product_code}</div>
                            <div class="cart-item-desc">${getLocalizedDescription(item)}</div>
                            <div class="cart-item-meta">
                                <span class="cart-item-status ${statusClass}">${getLocalizedStatus(item.status)}</span>
                                <span class="cart-item-qty">${t('qtyLabel')}: ${item.quantity}</span>
                            </div>
                            ${alternativesText}
                            ${moqExceptionText}
                        </div>
                        <div class="cart-item-actions">
                            <button class="cart-item-remove" onclick="removeFromBasket(${index})">${t('remove')}</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        // Add JS for global image preview
        function showProductImgPreview(e, imgUrl) {
            const preview = document.getElementById('productImgPreviewGlobal');
            const img = document.getElementById('productImgPreviewImg');
            img.src = imgUrl;
            preview.classList.add('active');
            // Position near the emoji
            const rect = e.target.getBoundingClientRect();
            const previewWidth = 220;
            const previewHeight = 160;
            let top = rect.top - previewHeight - 12;
            if (top < 0) top = rect.bottom + 12;
            let left = rect.left + rect.width / 2 - previewWidth / 2;
            if (left < 8) left = 8;
            if (left + previewWidth > window.innerWidth - 8) left = window.innerWidth - previewWidth - 8;
            preview.style.top = `${top}px`;
            preview.style.left = `${left}px`;
        }
        function hideProductImgPreview() {
            document.getElementById('productImgPreviewGlobal').classList.remove('active');
        }
        // Remove scrollToCustomerForm and replace with openCustomerInfoModal
        function scrollToCustomerForm() {
            if (orderItems.length === 0) {
                alert('Please add at least one product to your order first');
                return;
            }
            openCustomerInfoModal();
        }
        function openCustomerInfoModal() {
            // Update the order summary in the modal
            updateOrderSummaryDisplayModal();
            document.getElementById('customerInfoModal').style.display = 'flex';
            // Initialize floating labels after a short delay to ensure DOM is ready
            setTimeout(initializeFloatingLabels, 100);
        }
        function closeCustomerInfoModal() {
            document.getElementById('customerInfoModal').style.display = 'none';
        }
        // Update order summary in modal
        function updateOrderSummaryDisplayModal() {
            const orderSummaryBody = document.getElementById('orderSummaryBodyModal');
            if (!orderSummaryBody) return;
            if (orderItems.length === 0) {
                orderSummaryBody.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">No products in your order</p>';
                return;
            }
            let summaryHTML = `
                <div style="overflow-x: auto; margin-bottom: 20px;">
                    <table class="summary-table" style="width: 100%; min-width: 600px;">
                        <thead>
                            <tr>
                                <th id="sumThCode2">${t('thCode')}</th>
                                <th id="sumThDesc2">${t('thDesc')}</th>
                                <th id="sumThStatus2">${t('thStatus')}</th>
                                <th id="sumThQty2">${t('thQuantity')}</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            orderItems.forEach((item, index) => {
                const statusClass = getStatusClass(item.status);
                const alternatives = item.requestedAlternatives || [];
                let alternativesBadge = '';
                if (alternatives.length > 0) {
                    alternativesBadge = `<div class=\"basket-alternatives\" style=\"color:#007bff; font-weight:bold; background:#f8f9ff; border-left:3px solid #007bff; margin-top:4px;\">üí° Alternatives: ${alternatives.map(alt => {
                        const labels = {
                            'color': 'Different Color',
                            'size': 'Different Size',
                            'similar-size': 'Similar Size',
                            'similar-product': 'Similar Product',
                            'remove': 'Remove if Unavailable'
                        };
                        return labels[alt] || alt;
                    }).join(', ')}</div>`;
                }
                // MOQ Exception info
                let moqExceptionBadge = '';
                if (item.moqException === 'stock') {
                    moqExceptionBadge = `<div class=\"basket-alternatives\" style=\"color:#856404; font-weight:bold; background:#fff3cd; border-left:3px solid #ffc107; margin-top:4px;\">‚ö†Ô∏è ${t('moqStockMessage')}</div>`;
                } else if (item.moqException === 'moq') {
                    moqExceptionBadge = `<div class=\"basket-alternatives\" style=\"color:#007bff; font-weight:bold; background:#e3f0ff; border-left:3px solid #007bff; margin-top:4px;\">‚¨ÜÔ∏è ${t('moqIncreasedMessage')} (${item.moq} adet)</div>`;
                }
                summaryHTML += `
                    <tr>
                        <td><strong>${item.canias_code || item.product_code}</strong></td>
                        <td>${getLocalizedDescription(item)}<span class='product-img-emoji' onmouseenter="showProductImgPreview(event, 'https://www.dogukanlevent.com/RFQ-Web/PHLogo.png')" onmouseleave="hideProductImgPreview()">üñºÔ∏è</span>${alternativesBadge}${moqExceptionBadge}</td>
                        <td class=\"${statusClass}\">${getLocalizedStatus(item.status)}</td>
                        <td><strong>${item.quantity}</strong></td>
                    </tr>
                `;
            });
            summaryHTML += `
                        </tbody>
                    </table>
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: #495057;" id="orderSummaryBoxTitle2">${t('orderSummary')}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <strong id="totalProductsLabel2">${t('totalProducts')}</strong> ${orderItems.length}
                        </div>
                        <div>
                            <strong id="totalQuantityLabel2">${t('totalQuantity')}</strong> ${orderItems.reduce((sum, item) => sum + parseInt(item.quantity), 0)}
                        </div>
                    </div>
                </div>
            `;
            orderSummaryBody.innerHTML = summaryHTML;
        }
        // Close modal function
        function closeCustomerInfoModal() {
            document.getElementById('customerInfoModal').style.display = 'none';
        }
        // Two-step modal logic
        function showCustomerInfoStep() {
            document.getElementById('checkoutStepSummary').style.display = 'none';
            document.getElementById('checkoutStepCustomer').style.display = 'block';
            updateOrderSummaryDisplayModal();
            initializeFloatingLabels();
        }

        // Initialize floating label behavior
        function initializeFloatingLabels() {
            const inputs = document.querySelectorAll('.form-group-modern input, .form-group-modern textarea');
            inputs.forEach(input => {
                // Remove any existing event listeners to avoid duplicates
                input.removeEventListener('input', handleInputChange);
                input.removeEventListener('focus', handleInputFocus);
                input.removeEventListener('blur', handleInputBlur);
                
                // Check if input has value on load
                updateLabelState(input);
                
                // Add event listeners
                input.addEventListener('input', handleInputChange);
                input.addEventListener('focus', handleInputFocus);
                input.addEventListener('blur', handleInputBlur);
            });
        }
        
        function handleInputChange(e) {
            updateLabelState(e.target);
        }
        
        function handleInputFocus(e) {
            e.target.classList.add('focused');
        }
        
        function handleInputBlur(e) {
            e.target.classList.remove('focused');
            updateLabelState(e.target);
        }
        
        function updateLabelState(input) {
            const label = input.parentElement.querySelector('label');
            if (input.value.trim() !== '') {
                input.classList.add('has-value');
                if (label) label.classList.add('floating');
            } else {
                input.classList.remove('has-value');
                if (label) label.classList.remove('floating');
            }
        }
        function showOrderSummaryStep() {
            document.getElementById('checkoutStepSummary').style.display = 'block';
            document.getElementById('checkoutStepCustomer').style.display = 'none';
            updateOrderSummaryDisplayModal();
        }
        
        // View switching functionality
        let currentView = 'list';
        let currentProductData = [];
        
        function switchView(view) {
            currentView = view;
            
            // Update button states
            document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
            document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
            
            // Show/hide appropriate views
            const tableContainer = document.querySelector('.product-table').parentElement;
            const gridContainer = document.getElementById('productGrid');
            
            if (view === 'list') {
                tableContainer.style.display = 'block';
                gridContainer.classList.remove('active');
            } else {
                tableContainer.style.display = 'none';
                gridContainer.classList.add('active');
                renderProductGrid();
            }
        }
        
        function renderProductGrid() {
            const gridContainer = document.getElementById('productGrid');
            gridContainer.innerHTML = '';
            
            if (!currentProductData || currentProductData.length === 0) {
                gridContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No products to display</div>';
                return;
            }
            
            currentProductData.forEach(product => {
                const card = createProductCard(product);
                gridContainer.appendChild(card);
            });
        }
        
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            
            // Get product image using short code
            const productImage = getProductImage(product);
            
            // Get localized description
            const description = getLocalizedDescription(product);
            
            // Get status label
            let statusLabel = 'Unknown';
            let statusClass = 'unavailable';
            if (product.status === 'active') {
                statusLabel = currentLanguage === 'tr' ? 'Aktif' : 'Active';
                statusClass = 'available';
            } else if (product.status === 'passive' || product.status === 'to-be-consumed' || product.status === 'unknown') {
                statusLabel = currentLanguage === 'tr' ? 'Kontrol' : 'Control';
                statusClass = 'control';
            }
            
            // Get pack and MOQ info
            const packingQty = parseInt(product.packing_qty) || 1;
            const moq = parseInt(product.moq) || 1;
            
            card.innerHTML = `
                <div class="product-image">
                    ${productImage ? `<img src="${productImage}" alt="${description}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : ''}
                    <div class="product-image-placeholder" style="${productImage ? 'display: none;' : ''}">üì¶</div>
            </div>
                <div class="product-code">${product.product_code || 'N/A'}</div>
                <div class="product-name">${description || 'No description'}</div>
                <div class="product-status">
                    <span class="status-badge ${statusClass}">
                        ${statusLabel}
                    </span>
            </div>
                <button class="add-to-basket-btn" onclick="openQuantityModal('${product.product_code}', '${description.replace(/'/g, "\\'")}')" ${product.status !== 'active' ? 'disabled' : ''}>
                    <span class="add-icon">+</span>
                    <span>${t('addToBasket')}</span>
                </button>
            `;
            
            return card;
        }
        
        function getProductImage(product) {
            // Extract short code from product object
            const shortCode = product.short_code || product.product_code;
            
            // If we have a short code, try to load the image
            if (shortCode) {
                // Construct image path using short code
                const imagePath = `https://cdn.shopify.com/s/files/1/0788/6507/2462/files/${shortCode}.png`;
                
                // Return the image path - the browser will handle loading and fallback
                return imagePath;
            }
            
            // Fallback to placeholder if no short code
            return 'https://www.dogukanlevent.com/RFQ-Web/PHLogo.png';
        }
        
        // Quantity modal functionality
        let selectedProductCode = '';
        let selectedProductName = '';
        
        function openQuantityModal(code, name) {
            selectedProductCode = code;
            selectedProductName = name;
            
            // Find the product to get pack and MOQ info
            let product = allProducts.find(p => p.product_code === code);
            if (!product && window.filteredProducts) {
                product = window.filteredProducts.find(p => p.product_code === code);
            }
            
            document.getElementById('quantityModalProduct').textContent = name;
            
            // Display pack and MOQ information
            if (product) {
                const packingQty = parseInt(product.packing_qty) || 1;
                const moq = parseInt(product.moq) || 1;
                
                document.getElementById('quantityModalPack').textContent = `${t('packLabel')}: ${packingQty}`;
                document.getElementById('quantityModalMOQ').textContent = moq > 1 ? `MOQ: ${moq}` : '';
                
                // Set input constraints
                const quantityInput = document.getElementById('quantityInput');
                quantityInput.min = moq;
                quantityInput.step = packingQty;
            }
            
            document.getElementById('quantityInput').value = 1;
            document.getElementById('quantityModal').classList.add('active');
            
            // Focus on quantity input
            setTimeout(() => {
                document.getElementById('quantityInput').focus();
            }, 100);
        }
        
        function closeQuantityModal() {
            document.getElementById('quantityModal').classList.remove('active');
            selectedProductCode = '';
            selectedProductName = '';
        }
        
        function addToBasketFromModal() {
            const quantity = parseInt(document.getElementById('quantityInput').value);
            
            if (quantity < 1) {
                alert(t('quantityValidError'));
                return;
            }
            
            // Find the product in current data
            const product = currentProductData.find(p => p.product_code === selectedProductCode);
            if (product) {
                const description = getLocalizedDescription(product);
                addToOrder(product.product_code, description, quantity);
                closeQuantityModal();
                showNotification('Success', `Added ${quantity} x ${description} to basket`, 'success');
            }
        }
        
        // reCAPTCHA Modal Functions
        let recaptchaVerified = false;
        let pendingOrderData = null;
        let currentOrderData = null;
        
        function showRecaptchaModal(orderData) {
            console.log('showRecaptchaModal called with:', orderData);
            pendingOrderData = orderData;
            recaptchaVerified = false;
            document.getElementById('recaptchaModal').classList.add('active');
            document.getElementById('recaptchaModalVerify').disabled = true;
            document.body.classList.add('recaptcha-modal-open');
            
            // Reset reCAPTCHA
            if (typeof grecaptcha !== 'undefined') {
                grecaptcha.reset();
                console.log('reCAPTCHA reset');
            } else {
                console.error('reCAPTCHA not loaded!');
            }
        }
        
        function closeRecaptchaModal() {
            document.getElementById('recaptchaModal').classList.remove('active');
            document.body.classList.remove('recaptcha-modal-open');
            pendingOrderData = null;
            recaptchaVerified = false;
        }
        
        function onRecaptchaSuccess(token) {
            console.log('reCAPTCHA Success! Token:', token);
            recaptchaVerified = true;
            const verifyBtn = document.getElementById('recaptchaModalVerify');
            if (verifyBtn) {
                verifyBtn.disabled = false;
                console.log('Verify button enabled');
            } else {
                console.error('Verify button not found!');
            }
        }
        
        function onRecaptchaExpired() {
            recaptchaVerified = false;
            document.getElementById('recaptchaModalVerify').disabled = true;
        }
        
        function verifyAndSendOrder() {
            console.log('verifyAndSendOrder called');
            console.log('recaptchaVerified:', recaptchaVerified);
            console.log('pendingOrderData:', pendingOrderData);
            
            if (!recaptchaVerified) {
                alert('Please complete the reCAPTCHA verification first.');
                return;
            }
            
            if (!pendingOrderData) {
                alert('No order data found. Please try again.');
                return;
            }
            
            console.log('Proceeding with order send...');
            
            // Extract data BEFORE closing the modal
            const { customerInfo, emailBody, orderData } = pendingOrderData;
            
            // Store order data for confirmation screen
            currentOrderData = orderData;
            
            // Close the modal
            closeRecaptchaModal();
            
            // Send the order
            sendEmail(customerInfo.email, emailBody, orderData);
        }
        
        // Order Confirmation Screen Functions
        function showOrderConfirmation(orderNumber) {
            console.log('showOrderConfirmation called with orderNumber:', orderNumber);
            console.log('currentOrderData:', currentOrderData);
            
            // Hide all other content
            const mainContent = document.querySelector('.rfq-main-content') || 
                               document.querySelector('.main-content') || 
                               document.querySelector('main') ||
                               document.querySelector('.unified-interface-container');
            const header = document.querySelector('.rfq-header') || 
                          document.querySelector('header');
            
            if (mainContent) {
                mainContent.style.display = 'none';
                console.log('Main content hidden');
            } else {
                console.warn('Main content not found - this is normal in some layouts');
            }
            
            if (header) {
                header.style.display = 'none';
                console.log('Header hidden');
            } else {
                console.warn('Header not found - this is normal in some layouts');
            }
            
            // Show confirmation screen
            const confirmationScreen = document.getElementById('orderConfirmationScreen');
            if (confirmationScreen) {
                confirmationScreen.classList.add('active');
                console.log('Confirmation screen activated');
                
                // Add click event listeners to buttons
                const newOrderBtn = document.getElementById('confirmationNewOrder');
                const homeBtn = document.getElementById('confirmationHome');
                
                if (newOrderBtn) {
                    newOrderBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('New Order button clicked via event listener');
                        startNewOrder();
                    });
                }
                
                if (homeBtn) {
                    homeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        console.log('Home button clicked via event listener');
                        goToHome();
                    });
                }
            } else {
                console.error('Confirmation screen element not found!');
            }
            
            // Populate confirmation details
            if (currentOrderData) {
                const orderNumberEl = document.getElementById('confirmationOrderNumber');
                const dateEl = document.getElementById('confirmationDate');
                const emailEl = document.getElementById('confirmationEmail');
                
                if (orderNumberEl) orderNumberEl.textContent = orderNumber;
                if (dateEl) dateEl.textContent = currentOrderData.orderDate;
                if (emailEl) emailEl.textContent = currentOrderData.customer.email;
                
                console.log('Confirmation details populated');
            } else {
                console.error('No currentOrderData available');
            }
        }
        
        function startNewOrder() {
            console.log('startNewOrder function called');
            
            // Clear all data
            orderItems = [];
            updateBasket();
            updateOrderSummaryDisplay();
            document.getElementById('customerForm').reset();
            localStorage.removeItem('orderDraft');
            currentOrderData = null;
            
            // Hide confirmation screen
            const confirmationScreen = document.getElementById('orderConfirmationScreen');
            if (confirmationScreen) {
                confirmationScreen.classList.remove('active');
                console.log('Confirmation screen hidden');
            } else {
                console.log('Confirmation screen not found');
            }
            
            // Show main content
            const mainContent = document.querySelector('.rfq-main-content') || 
                               document.querySelector('.main-content') || 
                               document.querySelector('main') ||
                               document.querySelector('.unified-interface-container');
            if (mainContent) {
                mainContent.style.display = 'block';
                console.log('Main content shown');
            } else {
                console.log('Main content not found');
            }
            
            // Show header
            const header = document.querySelector('.rfq-header') || 
                          document.querySelector('header');
            if (header) {
                header.style.display = 'flex';
                console.log('Header shown');
            } else {
                console.log('Header not found');
            }
            
            // Close any open modals
            closeCustomerInfoModal();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        function goToHome() {
            console.log('goToHome function called');
            
            // Clear all data
            orderItems = [];
            updateBasket();
            updateOrderSummaryDisplay();
            document.getElementById('customerForm').reset();
            localStorage.removeItem('orderDraft');
            currentOrderData = null;
            
            // Hide confirmation screen
            const confirmationScreen = document.getElementById('orderConfirmationScreen');
            if (confirmationScreen) {
                confirmationScreen.classList.remove('active');
                console.log('Confirmation screen hidden');
            } else {
                console.log('Confirmation screen not found');
            }
            
            // Show main content
            const mainContent = document.querySelector('.rfq-main-content') || 
                               document.querySelector('.main-content') || 
                               document.querySelector('main') ||
                               document.querySelector('.unified-interface-container');
            if (mainContent) {
                mainContent.style.display = 'block';
                console.log('Main content shown');
            } else {
                console.log('Main content not found');
            }
            
            // Show header
            const header = document.querySelector('.rfq-header') || 
                          document.querySelector('header');
            if (header) {
                header.style.display = 'flex';
                console.log('Header shown');
            } else {
                console.log('Header not found');
            }
            
            // Close any open modals
            closeCustomerInfoModal();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Override the existing loadProductsFromServer to also populate grid
        const originalLoadProducts = loadProductsFromServer;
        loadProductsFromServer = async function() {
            await originalLoadProducts();
            // After loading products, update currentProductData for grid view
            if (currentView === 'grid') {
                renderProductGrid();
            }
        };
        
        // Override the existing displayProducts to also update grid
        const originalDisplayProducts = displayProducts;
        displayProducts = function(filteredProducts = products) {
            currentProductData = filteredProducts;
            originalDisplayProducts(filteredProducts);
            if (currentView === 'grid') {
                renderProductGrid();
            }
        };
        
        // Debug function to check products status
        window.debugProducts = function() {
            console.log('=== PRODUCTS DEBUG ===');
            console.log('Products array:', products);
            console.log('Products length:', products ? products.length : 'undefined');
            console.log('All products length:', allProducts ? allProducts.length : 'undefined');
            console.log('Current product data length:', currentProductData ? currentProductData.length : 'undefined');
            console.log('CSV file path:', CSV_FILE_PATH);
            console.log('Current view:', currentView);
            console.log('========================');
        };
        
        // Debug function to check categories status
        window.debugCategories = function() {
            console.log('=== CATEGORIES DEBUG ===');
            console.log('CategoriesMain array:', categoriesMain);
            console.log('CategoriesMain length:', categoriesMain ? categoriesMain.length : 'undefined');
            console.log('CategoriesSub array:', categoriesSub);
            console.log('CategoriesSub length:', categoriesSub ? categoriesSub.length : 'undefined');
            console.log('Categories file path:', CATEGORIES_FILE_PATH);
            console.log('========================');
        };

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('quantityModal');
            if (e.target === modal) {
                closeQuantityModal();
            }
        });
        
        // Handle Enter key in quantity input
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('quantityModal').classList.contains('active')) {
                addToBasketFromModal();
            }
            if (e.key === 'Escape' && document.getElementById('quantityModal').classList.contains('active')) {
                closeQuantityModal();
            }
        });
    </script>
    
                </div>
    
    <div class="product-img-preview-global" id="productImgPreviewGlobal">
        <img src="" alt="Product Image" id="productImgPreviewImg" style="max-width:200px; max-height:140px; display:block; border-radius:8px;"/>
                </div>
    
    <!-- Quantity Modal -->
    <div class="quantity-modal" id="quantityModal">
        <div class="quantity-modal-content">
            <h3 id="quantityModalTitle">Add to Basket</h3>
            <p id="quantityModalProduct">Product Name</p>
            <div id="quantityModalPackInfo" style="margin: 16px 0; padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 0.9em; color: #666;">
                <div id="quantityModalPack"></div>
                <div id="quantityModalMOQ"></div>
            </div>
            <div class="quantity-input-group">
                <label for="quantityInput" id="quantityModalLabel">Quantity:</label>
                <input type="number" id="quantityInput" min="1" value="1" placeholder="Enter quantity">
        </div>
            <div class="quantity-modal-buttons">
                <button class="quantity-modal-btn secondary" onclick="closeQuantityModal()" id="quantityModalCancel">Cancel</button>
                <button class="quantity-modal-btn primary" onclick="addToBasketFromModal()" id="quantityModalAdd">Add to Basket</button>
    </div>
    </div>
    </div>
    
    <!-- reCAPTCHA Verification Modal -->
    <div class="recaptcha-modal" id="recaptchaModal">
        <div class="recaptcha-modal-content">
            <h3 id="recaptchaModalTitle">Security Verification</h3>
            <p id="recaptchaModalDesc">Please complete the security verification to send your order request.</p>
            <div class="recaptcha-container">
                <div class="g-recaptcha" data-sitekey="6LfCP8IrAAAAAILnvfqKBDV9XQ670CPr1qpBlrBy" data-callback="onRecaptchaSuccess" data-expired-callback="onRecaptchaExpired"></div>
            </div>
            <div class="recaptcha-modal-buttons">
                <button class="recaptcha-modal-btn secondary" onclick="closeRecaptchaModal()" id="recaptchaModalCancel">Cancel</button>
                <button class="recaptcha-modal-btn primary" onclick="verifyAndSendOrder()" id="recaptchaModalVerify" disabled>Verify & Send Order</button>
            </div>
        </div>
    </div>
    
    <!-- Order Confirmation Screen -->
    <div class="order-confirmation-screen" id="orderConfirmationScreen">
        <div class="order-confirmation-content">
            <div class="confirmation-icon">‚úÖ</div>
            <h2 id="confirmationTitle">Request Received!</h2>
            <p id="confirmationMessage">Thank you for your request. We have received your inquiry and will respond to you via email shortly.</p>
            <div class="confirmation-details">
                <div class="confirmation-item">
                    <span class="confirmation-label" id="confirmationOrderNumberLabel">Request Number:</span>
                    <span class="confirmation-value" id="confirmationOrderNumber">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label" id="confirmationDateLabel">Date:</span>
                    <span class="confirmation-value" id="confirmationDate">-</span>
                </div>
                <div class="confirmation-item">
                    <span class="confirmation-label" id="confirmationEmailLabel">Email:</span>
                    <span class="confirmation-value" id="confirmationEmail">-</span>
                </div>
            </div>
            <div class="confirmation-actions">
                <button class="confirmation-btn primary" onclick="startNewOrder()" id="confirmationNewOrder" style="pointer-events: auto; z-index: 100000;">Start New Order</button>
                <button class="confirmation-btn secondary" onclick="goToHome()" id="confirmationHome" style="pointer-events: auto; z-index: 100000;">Back to Products</button>
            </div>
        </div>
    </div>
</body>
</html>
</html>